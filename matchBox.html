<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥§å¤šæ¯”æ¶ˆæ¶ˆæ¨‚ - 2026è¡ŒéŠ·æ´»å‹•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Roboto+Mono:wght@500&display=swap');
        body { font-family: 'Inter', sans-serif; user-select: none; }
        
        .grid-cell { will-change: transform; }
        
        /* è®“åœ–ç‰‡ä¸èƒ½è¢«æ‹–æ›³ */
        .grid-cell img {
            pointer-events: none; 
            -webkit-user-drag: none;
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 3px rgba(0,0,0,0.3)); 
        }
        
        .selected {
            transform: scale(1.15);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
            background-color: rgba(255,255,255,0.1);
            border-radius: 18px;
            z-index: 20 !important;
        }

        /* æ¶ˆé™¤å‹•ç•« */
        .match-anim { animation: popOut 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; z-index: 10; }
        @keyframes popOut {
            0% { transform: scale(1); opacity: 1; filter: brightness(1); }
            40% { transform: scale(1.4); opacity: 0.9; filter: brightness(1.5); }
            100% { transform: scale(0); opacity: 0; filter: brightness(1); }
        }

        /* æ™ƒå‹•èˆ‡ç‰¹æ•ˆ */
        .shake-anim { animation: shake 0.3s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake-intense { animation: shakeIntense 0.2s infinite; }
        @keyframes shakeIntense {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(-3px, 3px) rotate(-5deg); }
            50% { transform: translate(3px, -3px) rotate(5deg); }
            75% { transform: translate(-3px, -3px) rotate(-5deg); }
            100% { transform: translate(3px, 3px) rotate(5deg); }
        }
        .screen-shake-combo { animation: screenShake 0.3s ease-in-out; }
        @keyframes screenShake {
            0% { transform: translate(0, 0); }
            20% { transform: translate(-5px, 5px); }
            40% { transform: translate(5px, -5px); }
            60% { transform: translate(-5px, -5px); }
            80% { transform: translate(5px, 5px); }
            100% { transform: translate(0, 0); }
        }
        
        /* ç‰¹æ®Šæ–¹å¡Šç‰¹æ•ˆ */
        .mystery-pulse { animation: mysteryPulse 1.5s infinite; }
        @keyframes mysteryPulse {
            0% { filter: drop-shadow(0 0 2px #fff); transform: scale(1); }
            50% { filter: drop-shadow(0 0 8px #D29BFF); transform: scale(1.02); }
            100% { filter: drop-shadow(0 0 2px #fff); transform: scale(1); }
        }
        .bomb-pulse { animation: bombPulse 1s infinite; }
        @keyframes bombPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); filter: brightness(1.2); }
            100% { transform: scale(1); }
        }
        .explosion-fire {
            background: radial-gradient(circle, #fff700 10%, #ff8800 50%, #ff0000 90%);
            border-radius: 8px;
            animation: fireExpand 0.4s ease-out forwards;
            box-shadow: 0 0 15px #ff4500;
            z-index: 50;
        }
        @keyframes fireExpand {
            0% { transform: scale(0.5); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }

        /* Combo æ–‡å­— */
        .combo-text-anim {
            position: absolute; left: 50%; top: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem; font-weight: 900; color: #FFFF00;
            text-shadow: 4px 4px 0px #FF0000, 0 0 20px rgba(255, 165, 0, 0.8);
            font-family: 'Inter', sans-serif; font-style: italic;
            z-index: 100; pointer-events: none; white-space: nowrap;
            animation: comboFloat 0.8s ease-out forwards;
        }
        @keyframes comboFloat {
            0% { transform: translate(-50%, -50%) scale(0.5) rotate(-10deg); opacity: 0; }
            30% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
            100% { transform: translate(-50%, -150%) scale(1) rotate(0deg); opacity: 0; }
        }

        /* çå‹µæŒ‰éˆ•ç‰¹æ•ˆ */
        .reward-btn-pulse {
            animation: rewardPulse 2s infinite;
        }
        @keyframes rewardPulse {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(234, 179, 8, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        #leaderboard-section { transition: height 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center overflow-hidden">

    <canvas id="fireworks-canvas" class="fixed inset-0 pointer-events-none z-50"></canvas>

    <div id="app" class="w-full max-w-5xl h-screen md:h-auto md:min-h-[850px] flex flex-col md:flex-row gap-6 p-4 relative">
        
        <div id="game-container" class="flex-1 flex flex-col items-center justify-center bg-gray-800 rounded-3xl p-6 shadow-2xl border border-gray-700 relative overflow-hidden z-10 transition-transform">
            
            <div id="tip-container" class="w-full bg-gray-900/60 rounded-lg mb-4 flex items-center min-h-[40px] border border-gray-700/50 backdrop-blur-sm overflow-hidden relative">
                <div id="tip-content" class="absolute top-1/2 -translate-y-1/2 whitespace-nowrap text-sm md:text-base text-gray-200 font-medium will-change-transform"></div>
            </div>

            <div class="w-full flex items-end justify-between mb-4 px-1 gap-2 md:gap-4">
                <div class="flex flex-col flex-shrink-0">
                    <span class="text-[10px] md:text-xs text-gray-400 uppercase tracking-wider mb-1">SCORE / LEVEL</span>
                    <div class="flex items-baseline gap-1 md:gap-2">
                        <span id="score-display" class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 font-mono">0</span>
                        <span class="text-xs md:text-sm text-gray-500 font-bold">LV.<span id="level-display">1</span></span>
                    </div>
                </div>
                <div class="flex-1 flex flex-col justify-end pb-2 px-2 md:px-4 min-w-[60px]">
                     <div class="flex justify-between text-[10px] text-gray-400 mb-1">
                        <span>EXP</span>
                        <span id="progress-percent">0%</span>
                     </div>
                     <div class="w-full bg-gray-700 h-1.5 md:h-2 rounded-full overflow-hidden border border-gray-600">
                        <div id="level-progress" class="bg-blue-500 h-full w-0 transition-all duration-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
                     </div>
                </div>
                <div class="flex flex-col items-end flex-shrink-0">
                    <span class="text-[10px] md:text-xs text-gray-400 uppercase tracking-wider mb-1">TIME</span>
                    <span id="time-display" class="text-3xl md:text-4xl font-black text-red-400 font-mono drop-shadow-lg">60</span>
                </div>
            </div>

            <div class="relative bg-gray-900/50 p-2 md:p-3 rounded-2xl border border-gray-700/50 shadow-inner backdrop-blur-sm">
                <div id="flash-overlay" class="absolute inset-0 pointer-events-none z-20 rounded-2xl"></div>
                <div id="game-grid" class="grid grid-cols-8 gap-1 md:gap-1.5 w-[320px] h-[320px] sm:w-[420px] sm:h-[420px] md:w-[520px] md:h-[520px] relative">
                    </div>
                
                <div id="overlay" class="absolute inset-0 bg-gray-900/95 z-30 flex flex-col items-center justify-center rounded-2xl backdrop-blur-md transition-opacity duration-300 px-4">
                    <div class="text-center mb-6 md:mb-8 transform hover:scale-105 transition duration-500">
                        <h1 class="text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-[#FF0000] via-[#D29BFF] to-[#31A8FF] mb-2 drop-shadow-2xl font-[sans-serif]">
                            å¥§å¤šæ¯”<br>æ¶ˆæ¶ˆæ¨‚
                        </h1>
                        <p class="text-gray-400 text-xs md:text-sm tracking-[0.2em] uppercase">Creative Cloud Edition</p>
                    </div>
                    
                    <div id="start-screen-content" class="flex flex-col items-center w-full px-4 space-y-4">
                        <div id="liff-status" class="text-xs text-green-400 mb-2 font-mono hidden">LIFF å·²é€£ç·š</div>
                        <input type="text" id="player-name-input" placeholder="è¼¸å…¥æ‚¨çš„æš±ç¨±" class="w-full max-w-xs bg-gray-800 border border-gray-600 text-white text-center rounded-xl px-4 py-4 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 placeholder-gray-500 transition-all text-lg">
                        <button id="start-btn" class="w-full max-w-xs bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-4 px-6 rounded-xl transform transition active:scale-95 shadow-lg shadow-blue-900/30 flex items-center justify-center gap-2 group">
                            <span>é–‹å§‹éŠæˆ²</span>
                            <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </button>
                    </div>

                    <div id="game-over-content" class="hidden flex flex-col items-center w-full text-center animate-in fade-in zoom-in duration-300 overflow-y-auto max-h-full py-4">
                        <p class="text-3xl font-bold text-white mb-2">éŠæˆ²çµæŸï¼</p>
                        <div class="bg-gray-800/80 p-6 rounded-xl border border-gray-600 mb-4 w-full max-w-xs">
                            <p class="text-sm text-gray-400 mb-1">æœ€çµ‚å¾—åˆ†</p>
                            <p class="text-4xl text-yellow-400 font-mono font-bold tracking-tight"><span id="final-score">0</span></p>
                        </div>
                        
                        <div class="flex flex-col gap-3 w-full max-w-xs">
                            
                            <button id="claim-reward-btn" class="hidden w-full bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-400 hover:to-amber-500 text-white font-black py-4 px-8 rounded-xl transition shadow-lg active:scale-95 border-2 border-yellow-300/50 reward-btn-pulse flex items-center justify-center gap-2">
                                <span class="text-xl">ğŸ</span> é ˜å–é€šé—œçå‹µ
                            </button>

                            <button id="restart-btn" class="w-full bg-white hover:bg-gray-100 text-gray-900 font-bold py-3 px-8 rounded-xl border border-gray-200 transition shadow-lg active:scale-95">
                                å†ç©ä¸€æ¬¡
                            </button>
                            
                            <a id="oa-link-btn" href="https://line.me/R/ti/p/@910kziej" target="_blank" class="w-full flex items-center justify-center gap-2 bg-[#06C755] hover:bg-[#05b34c] text-white font-bold py-3 px-8 rounded-xl transition shadow-lg active:scale-95 border border-[#06C755]/50 group text-sm">
                                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M21.16 7.42c-1-3-5.26-5.22-10.4-5.22-6 0-10.76 3.12-10.76 8 0 3.32 2.3 6.13 6 7.37.5.11 1.07.33.8.92 0 0-.3.81-.37 1s-.07.25.14.36c1 .54 5.56-3.26 5.56-3.26a17.48 17.48 0 0 0 4.29-.68c4.32-.82 6.55-3.37 5.74-6.49zm-13.84 5.6a.41.41 0 0 1-.41.41h-2a.41.41 0 0 1-.41-.41v-3.76a.41.41 0 0 1 .41-.41.41.41 0 0 1 .41.41v3.35h1.59a.41.41 0 0 1 .41.41zm3.22 0a.41.41 0 0 1-.41.41h-.42a.41.41 0 0 1-.41-.41V9.67h-.06l-1.07 3.33a.4.4 0 0 1-.39.29h-.36a.4.4 0 0 1-.39-.27l-1.08-3.35h-.07v3.35a.41.41 0 0 1-.41.41.41.41 0 0 1-.41.41v-3.76a.41.41 0 0 1 .41-.41h.63a.41.41 0 0 1 .38.28l.89 2.76h.05l.89-2.76a.41.41 0 0 1 .39-.28h.59a.41.41 0 0 1 .41.41zm2.37-3.35h-1.63v1.07h1.63a.41.41 0 0 1 .41.41.41.41 0 0 1-.41.41h-1.63v1.05h1.63a.41.41 0 0 1 .41.41.41.41 0 0 1-.41.41h-2a.41.41 0 0 1-.41-.41v-3.76a.41.41 0 0 1 .41-.41h2a.41.41 0 0 1 .41.41.41.41 0 0 1-.41.41zm4.7 0H16v1.07h1.63a.41.41 0 0 1 .41.41.41.41 0 0 1-.41.41H16v1.05h1.63a.41.41 0 0 1 .41.41.41.41 0 0 1-.41.41h-2a.41.41 0 0 1-.41-.41v-3.76a.41.41 0 0 1 .41-.41h2a.41.41 0 0 1 .41.41.41.41 0 0 1-.41.41z"/></svg>
                                é—œæ³¨ Adobe ä»£ç†å•†
                            </a>
                        </div>
                    </div>
                </div>

                <div id="level-up-toast" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 z-20 transition-all duration-500">
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-black text-4xl px-8 py-4 rounded-xl shadow-2xl rotate-[-5deg] border-4 border-white whitespace-nowrap">
                        LEVEL UP!
                    </div>
                </div>
            </div>
            
            <div class="mt-4 flex gap-4 text-xs text-gray-500 justify-center">
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span> äº¤æ›</div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-yellow-400"></span> é€£ç·š</div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-indigo-600 border border-gray-600">?</span> é©šå–œ</div>
                <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-black border border-gray-600">ğŸ’£</span> ç‚¸å½ˆ</div>
            </div>
        </div>

        <div id="leaderboard-section" class="w-full md:w-80 bg-gray-800 rounded-3xl shadow-2xl border border-gray-700 flex flex-col overflow-hidden h-14 md:h-auto z-20 absolute bottom-4 left-4 right-4 md:relative md:bottom-auto md:left-auto md:right-auto md:block">
            <div id="leaderboard-header" class="p-4 flex justify-between items-center cursor-pointer md:cursor-default bg-gray-800 border-b border-gray-700 md:border-none">
                <h2 class="text-lg font-bold flex items-center gap-2 text-white">
                    <span class="text-2xl">ğŸ†</span> å…¨çƒæ’è¡Œæ¦œ
                </h2>
                <button class="md:hidden text-gray-400 focus:outline-none">
                    <svg id="chevron-icon" class="w-6 h-6 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
                </button>
            </div>
            <div id="leaderboard-content" class="flex-1 overflow-y-auto space-y-2 px-6 pb-6 pt-2 bg-gray-800 hidden md:block opacity-0 md:opacity-100 transition-opacity duration-300">
                <div id="leaderboard-list" class="space-y-2">
                    <div class="text-center text-gray-500 py-4 animate-pulse">é€£ç·šä¸­...</div>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        // æ³¨æ„ï¼šé€™è£¡éœ€è¦æ‚¨è‡ªå·±çš„ Firebase Config æ‰èƒ½è®“æ’è¡Œæ¦œé‹ä½œã€‚
        // å¦‚æœæ²’æœ‰å¡«å¯«ï¼ŒéŠæˆ²ä»ç„¶å¯ä»¥ç©ï¼Œä½†æ’è¡Œæ¦œæœƒé¡¯ç¤ºéŒ¯èª¤ã€‚
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // å¦‚æœæ‚¨æœ‰ Firebase Configï¼Œè«‹å¡«å…¥ä¸‹æ–¹ã€‚è‹¥ç„¡ï¼Œè«‹ä¿ç•™åŸæ¨£ï¼Œç¨‹å¼æœƒæ””æˆªéŒ¯èª¤ç¢ºä¿éŠæˆ²ç¹¼çºŒé‹è¡Œã€‚
        const firebaseConfig = { 
            /* æ‚¨çš„ firebase config */ 
        };
        
        let db = null;
        let auth = null;
        let currentUser = null;

        try {
            if (Object.keys(firebaseConfig).length > 0) {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                
                onAuthStateChanged(auth, (user) => {
                    currentUser = user;
                    if (user) setupLeaderboard();
                });
                
                // Init Auth
                signInAnonymously(auth).catch(console.error);
            }
        } catch (e) {
            console.log("Firebase not configured, leaderboard disabled.");
        }

        function setupLeaderboard() {
            if (!db) return;
            const q = collection(db, 'scores'); // Simplified collection path
            onSnapshot(q, (snapshot) => {
                const scores = [];
                snapshot.forEach((doc) => scores.push(doc.data()));
                scores.sort((a, b) => b.score - a.score);
                renderLeaderboardHTML(scores.slice(0, 20));
            });
        }

        function renderLeaderboardHTML(scores) {
            const list = document.getElementById('leaderboard-list');
            if (scores.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-500 py-4">æš«ç„¡ç´€éŒ„ï¼Œå¿«ä¾†æ¶ç¬¬ä¸€ï¼</div>';
                return;
            }
            list.innerHTML = scores.map((s, index) => {
                let rankClass = "text-gray-400";
                if (index === 0) rankClass = "text-yellow-400 font-bold";
                else if (index === 1) rankClass = "text-gray-300 font-bold";
                else if (index === 2) rankClass = "text-amber-600 font-bold";
                return `
                    <div class="flex justify-between items-center bg-gray-700/50 p-2 rounded hover:bg-gray-700 transition">
                        <div class="flex items-center gap-3">
                            <span class="w-6 text-center ${rankClass}">${index + 1}</span>
                            <div class="flex flex-col">
                                <span class="text-sm font-medium text-white truncate max-w-[100px]">${s.name || 'Anonymous'}</span>
                                <span class="text-xs text-gray-500">Lv.${s.level || 1}</span>
                            </div>
                        </div>
                        <span class="font-mono text-yellow-400 font-bold">${s.score}</span>
                    </div>
                `;
            }).join('');
        }
        
        // Expose function for the main script to call
        window.saveScoreToFirebase = async (score, level, name) => {
            if (!db || !currentUser || score === 0) return;
            try {
                await addDoc(collection(db, 'scores'), {
                    name: name,
                    score: score,
                    level: level,
                    userId: currentUser.uid,
                    timestamp: Date.now()
                });
            } catch (e) { console.error(e); }
        };
    </script>

    <script>
        // --- LIFF CONFIGURATION ---
        const LIFF_ID = '2008592497-pvgkXmM2';
        const REWARD_SCORE_THRESHOLD = 10000;
        const BOTBONNIE_KEYWORD = '#winæ¶ˆæ¶ˆæ¨‚';

        // --- Game Config ---
        const GRID_SIZE = 8;
        const BASE_TIME = 60;
        const LEVEL_THRESHOLD = 800; 
        const FIREWORKS_THRESHOLD = 10000;

        // --- Icons Data ---
        const ALL_TILES = [
            { id: 'Ps', name: 'Photoshop', file: 'Adobe_Photoshop_CC_icon.svg' },
            { id: 'Ai', name: 'Illustrator', file: 'Adobe_Illustrator_CC_icon.svg' },
            { id: 'Ac', name: 'Acrobat', file: 'Adobe_Acrobat_DC_logo_2020.svg' },
            { id: 'Fl', name: 'Firefly', file: 'Adobe_Firefly_Logo.svg' },
            { id: 'Ex', name: 'Express', file: 'Adobe_Express_logo_CMYK_256px.svg' },
            { id: 'Lr', name: 'Lightroom', file: 'Adobe_Photoshop_Lightroom_CC_logo.svg' },
            { id: 'Pr', name: 'Premiere', file: 'Adobe_Premiere_Pro_CC_icon.svg' },
            { id: 'Ae', name: 'After Effects', file: 'Adobe_After_Effects_CC_icon.svg'},
            { id: 'CC', name: 'Creative Cloud', file: 'Adobe_Creative_Cloud_rainbow_icon.svg'}
        ];

        // --- Tips Data ---
        const ADOBE_TIPS = [
            "ğŸ’¡ Ps å°æŠ€å·§ï¼šæŒ‰ä½ Space éµå¯ä»¥éš¨æ™‚åˆ‡æ›æˆæ‰‹å‹å·¥å…·ç§»å‹•ç•«é¢ã€‚",
            "ğŸ’¡ Ai å†·çŸ¥è­˜ï¼šCtrl + D å¯ä»¥é‡è¤‡ä¸Šä¸€å€‹è®Šå½¢å‹•ä½œï¼Œè£½ä½œé‡è¤‡åœ–æ¨£è¶…æ–¹ä¾¿ï¼",
            "ğŸ’¡ Pr å¯†æŠ€ï¼šæŒ‰ Q å’Œ W å¯ä»¥å¿«é€Ÿè£å‰ªæ³¢ç´‹ç·¨è¼¯ï¼Œå‰ªè¼¯é€Ÿåº¦å€å¢ã€‚",
            "ğŸ’¡ Ae æé†’ï¼šé–‹å•Ÿå‹•æ…‹æ¨¡ç³Š (Motion Blur) é–‹é—œï¼Œè®“ç§»å‹•çš„åœ–å±¤çœ‹èµ·ä¾†æ›´è‡ªç„¶ã€‚",
            "ğŸ’¡ Lr æŠ€å·§ï¼šåœ¨ç·¨è¼¯æ¨¡å¼ä¸‹æŒ‰ \\ éµï¼Œå¯ä»¥å¿«é€Ÿæ¯”å°ä¿®æ”¹å‰å¾Œçš„å·®ç•°ã€‚",
            "ğŸ’¡ Acrobatï¼šæ‰‹æ©Ÿä¸‹è¼‰ Acrobat Reader Appï¼Œå¯ä»¥æ‹ç…§ç›´æ¥æƒææˆ PDFã€‚",
            "ğŸ’¡ Fireflyï¼šä½¿ç”¨ Generative Fill (ç”Ÿæˆå¡«è‰²) å¯ä»¥å¿«é€Ÿæ“´å±•åœ–ç‰‡èƒŒæ™¯ã€‚",
            "ğŸ’¡ CC é›²ç«¯ï¼šå–„ç”¨ CC Libraryï¼Œå¯ä»¥åœ¨ä¸åŒè»Ÿé«”é–“ç§’é€ŸåŒæ­¥é¡è‰²å’ŒLogoã€‚",
            "ğŸ’¡ Expressï¼šä¸€éµã€Œç§»é™¤èƒŒæ™¯ã€åŠŸèƒ½éå¸¸å¼·å¤§ï¼Œé©åˆè£½ä½œç¤¾ç¾¤è²¼æ–‡ã€‚"
        ];
        
        // --- State ---
        let grid = []; 
        let score = 0;
        let timeLeft = BASE_TIME;
        let gameInterval = null;
        let isProcessing = false;
        let selectedTile = null; 
        let playerName = "Designer";
        let currentLevel = 1;
        let activeTileCount = 5; 
        let isLeaderboardOpen = false;
        let hasWonFireworks = false;
        let audioCtx = null;
        let gainNode = null;

        // --- DOM Elements ---
        const gameContainer = document.getElementById('game-container');
        const gridEl = document.getElementById('game-grid');
        const scoreEl = document.getElementById('score-display');
        const levelEl = document.getElementById('level-display');
        const levelProgressEl = document.getElementById('level-progress');
        const progressPercentEl = document.getElementById('progress-percent');
        const timeEl = document.getElementById('time-display');
        const overlayEl = document.getElementById('overlay');
        const startScreenContent = document.getElementById('start-screen-content');
        const gameOverContent = document.getElementById('game-over-content');
        const finalScoreEl = document.getElementById('final-score');
        const nameInput = document.getElementById('player-name-input');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const claimRewardBtn = document.getElementById('claim-reward-btn'); // New Reward Button
        const levelUpToast = document.getElementById('level-up-toast');
        const flashOverlay = document.getElementById('flash-overlay');
        const fireworksCanvas = document.getElementById('fireworks-canvas');
        const tipContainer = document.getElementById('tip-container');
        const tipContent = document.getElementById('tip-content');
        const leaderboardSection = document.getElementById('leaderboard-section');
        const leaderboardHeader = document.getElementById('leaderboard-header');
        const leaderboardContent = document.getElementById('leaderboard-content');
        const chevronIcon = document.getElementById('chevron-icon');
        const liffStatusEl = document.getElementById('liff-status');

        // --- LIFF Initialization ---
        async function initLIFF() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (liff.isLoggedIn()) {
                    liffStatusEl.classList.remove('hidden');
                    // Optional: Get User Profile
                    // const profile = await liff.getProfile();
                    // nameInput.value = profile.displayName; 
                } else {
                    liff.login();
                }
            } catch (error) {
                console.error("LIFF Init Error:", error);
            }
        }

        // --- Audio System ---
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                gainNode = audioCtx.createGain();
                gainNode.connect(audioCtx.destination);
                gainNode.gain.value = 0.3; 
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }
        function playTone(freq, type, duration, startTime = 0) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime + startTime);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime + startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + startTime + duration);
            osc.connect(gain);
            gain.connect(gainNode);
            osc.start(audioCtx.currentTime + startTime);
            osc.stop(audioCtx.currentTime + startTime + duration);
        }
        function playSwapSound() { playTone(300, 'sine', 0.1); }
        function playInvalidSound() { playTone(150, 'sawtooth', 0.1); setTimeout(() => playTone(100, 'sawtooth', 0.1), 100); }
        function playMatchSound(comboLevel = 0) {
            const baseFreqs = [523.25, 587.33, 659.25, 783.99, 880.00, 1046.50, 1174.66, 1318.51];
            const pitchIndex = Math.min(comboLevel, baseFreqs.length - 1);
            const freq = baseFreqs[pitchIndex];
            playTone(freq, 'sine', 0.2);
            playTone(freq * 2, 'sine', 0.2, 0.05);
        }
        function playLevelUpSound() {
            playTone(440, 'square', 0.1, 0); playTone(554, 'square', 0.1, 0.1);
            playTone(659, 'square', 0.2, 0.2); playTone(880, 'square', 0.4, 0.3);
        }
        function playMassiveClearSound() {
            playTone(100, 'sawtooth', 0.5); playTone(200, 'sine', 0.5);
            setTimeout(() => playTone(800, 'square', 0.3), 100);
        }

        // --- Fireworks System ---
        const particles = [];
        let fireworksLoop = null;
        function createFirework() {
            const x = Math.random() * fireworksCanvas.width;
            const y = Math.random() * (fireworksCanvas.height / 2); 
            const color = `hsl(${Math.random() * 360}, 100%, 50%)`;
            for (let i = 0; i < 50; i++) {
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 4 + 1;
                particles.push({
                    x: x, y: y, vx: Math.cos(angle) * velocity, vy: Math.sin(angle) * velocity,
                    life: 1, color: color, decay: Math.random() * 0.02 + 0.01
                });
            }
        }
        function drawFireworks() {
            if (fireworksCanvas.width !== window.innerWidth || fireworksCanvas.height !== window.innerHeight) {
                fireworksCanvas.width = window.innerWidth;
                fireworksCanvas.height = window.innerHeight;
            }
            const ctx = fireworksCanvas.getContext('2d');
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
            ctx.globalCompositeOperation = 'lighter';
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx; p.y += p.vy; p.vy += 0.05; p.life -= p.decay;
                ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fillStyle = p.color; ctx.globalAlpha = p.life; ctx.fill();
                if (p.life <= 0) particles.splice(i, 1);
            }
            if (Math.random() < 0.05) { createFirework(); playTone(200 + Math.random() * 600, 'square', 0.1); }
            fireworksLoop = requestAnimationFrame(drawFireworks);
        }
        function startFireworks() {
            fireworksCanvas.width = window.innerWidth;
            fireworksCanvas.height = window.innerHeight;
            drawFireworks();
            setTimeout(() => {
                cancelAnimationFrame(fireworksLoop);
                const ctx = fireworksCanvas.getContext('2d');
                ctx.clearRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
            }, 10000);
        }

        // --- Icon Generation ---
        function getIconSVG(tileData) {
            if (!tileData) return ''; 
            if (tileData.id === 'Mystery') return `<svg viewBox="0 0 100 100" class="w-full h-full drop-shadow-md mystery-pulse"><defs><linearGradient id="mysteryGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#4f46e5;stop-opacity:1"/><stop offset="100%" style="stop-color:#7e22ce;stop-opacity:1"/></linearGradient></defs><rect x="5" y="5" width="90" height="90" rx="22" fill="url(#mysteryGrad)"/><text x="50" y="65" font-family="sans-serif" font-weight="900" font-size="55" text-anchor="middle" fill="white">?</text></svg>`;
            if (tileData.id === 'Bomb') return `<div class="w-full h-full bg-gray-900/80 rounded-2xl flex items-center justify-center relative overflow-hidden bomb-pulse"><span class="text-4xl md:text-5xl drop-shadow-md filter drop-shadow(0 0 5px red)">ğŸ’£</span></div>`;
            return `<img src="https://commons.wikimedia.org/wiki/Special:FilePath/${tileData.file}" alt="${tileData.name}" class="w-full h-full object-contain pointer-events-none drop-shadow-md" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPj88L3RleHQ+PC9zdmc+'">`;
        }
        function getRandomTile() {
            const rand = Math.random();
            if (rand < 0.05) return { id: 'Mystery', name: 'Mystery Box' };
            if (rand < 0.08) return { id: 'Bomb', name: 'Bomb' };
            return ALL_TILES[Math.floor(Math.random() * activeTileCount)];
        }
        function getFireSVG() {
             return `<svg viewBox="0 0 100 100" class="w-full h-full explosion-fire"><circle cx="50" cy="50" r="40" fill="url(#fireGradient)"/><defs><radialGradient id="fireGradient"><stop offset="0%" stop-color="#ffff00"/><stop offset="50%" stop-color="#ff8800"/><stop offset="100%" stop-color="#ff0000"/></radialGradient></defs></svg>`;
        }

        // --- Game Mechanics ---
        function startTipsTicker() {
            const runTicker = () => {
                tipContent.innerText = ADOBE_TIPS[Math.floor(Math.random() * ADOBE_TIPS.length)];
                tipContent.style.transition = 'none'; tipContent.style.left = '100%'; void tipContent.offsetWidth;
                const duration = Math.max(8, (tipContainer.offsetWidth + tipContent.offsetWidth) / 100 * 4); 
                tipContent.style.transition = `left ${duration}s linear`;
                tipContent.style.left = `-${tipContent.offsetWidth}px`;
                setTimeout(runTicker, duration * 1000); 
            };
            runTicker();
        }

        function initGame() {
            score = 0; timeLeft = BASE_TIME; currentLevel = 1; activeTileCount = 5; hasWonFireworks = false;
            scoreEl.innerText = score; timeEl.innerText = timeLeft; levelEl.innerText = currentLevel;
            updateProgressBar();
            grid = []; gridEl.innerHTML = ''; selectedTile = null; isProcessing = false;
            createBoard(); cleanInitialBoard(); startTipsTicker();
            overlayEl.classList.add('hidden'); startScreenContent.classList.add('hidden'); gameOverContent.classList.add('hidden');
            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(() => {
                timeLeft--; timeEl.innerText = timeLeft;
                if (timeLeft <= 0) endGame();
                else if (timeLeft <= 10) timeEl.classList.add('animate-pulse', 'text-red-500');
            }, 1000);
            initAudio(); 
        }

        function updateProgressBar() {
            const nextLevelScore = currentLevel * LEVEL_THRESHOLD;
            const prevLevelScore = (currentLevel - 1) * LEVEL_THRESHOLD;
            const percentage = Math.min(100, Math.max(0, ((score - prevLevelScore) / (nextLevelScore - prevLevelScore)) * 100));
            levelProgressEl.style.width = `${percentage}%`;
            progressPercentEl.innerText = `${Math.floor(percentage)}%`;
        }
        function checkLevelUp() {
            if (activeTileCount >= ALL_TILES.length) return;
            if (score >= currentLevel * LEVEL_THRESHOLD) {
                currentLevel++; activeTileCount++; levelEl.innerText = currentLevel;
                playLevelUpSound();
                levelUpToast.style.opacity = '1'; levelUpToast.style.transform = 'translate(-50%, -150%) scale(1.2)';
                setTimeout(() => { levelUpToast.style.opacity = '0'; levelUpToast.style.transform = 'translate(-50%, -50%) scale(1)'; }, 2000);
                timeLeft += 15; timeEl.innerText = timeLeft;
                timeEl.classList.add('text-green-400'); setTimeout(() => timeEl.classList.remove('text-green-400'), 500);
            }
            updateProgressBar();
        }
        function checkFireworks() {
            if (score >= FIREWORKS_THRESHOLD && !hasWonFireworks) { hasWonFireworks = true; startFireworks(); }
        }
        function createBoard() {
            for (let y = 0; y < GRID_SIZE; y++) {
                let row = [];
                for (let x = 0; x < GRID_SIZE; x++) {
                    const tileData = getRandomTile();
                    const tile = createTileElement(tileData, x, y);
                    row.push({ tileData, x, y, element: tile });
                    gridEl.appendChild(tile);
                }
                grid.push(row);
            }
        }
        function createTileElement(tileData, x, y) {
            const div = document.createElement('div');
            div.className = 'grid-cell w-full h-full cursor-pointer hover:brightness-110 active:scale-95 flex items-center justify-center p-[2px] relative';
            div.innerHTML = getIconSVG(tileData);
            div.dataset.x = x; div.dataset.y = y;
            div.onclick = () => handleTileClick(x, y);
            return div;
        }
        function handleTileClick(x, y) {
            if (isProcessing || timeLeft <= 0) return;
            const clickedTile = grid[y][x];
            if (clickedTile.tileData.id === 'Mystery') { activateMysteryTile(clickedTile); return; }
            if (clickedTile.tileData.id === 'Bomb') { activateBombTile(clickedTile); return; }
            if (selectedTile) {
                if (selectedTile.x === x && selectedTile.y === y) deselectTile();
                else if (Math.abs(selectedTile.x - x) + Math.abs(selectedTile.y - y) === 1) { swapTiles(selectedTile, clickedTile); deselectTile(); }
                else { deselectTile(); selectTile(clickedTile); }
            } else { selectTile(clickedTile); }
        }

        // --- Tile Logics (Mystery, Bomb, Swap) ---
        function activateMysteryTile(tileObj) {
            isProcessing = true; deselectTile(); playTone(200, 'sine', 0.5);
            const targetTileData = ALL_TILES[Math.floor(Math.random() * activeTileCount)];
            let rouletteSteps = 0;
            const rouletteInterval = setInterval(() => {
                tileObj.element.innerHTML = getIconSVG(ALL_TILES[Math.floor(Math.random() * activeTileCount)]);
                if (++rouletteSteps > 8) {
                    clearInterval(rouletteInterval);
                    tileObj.element.innerHTML = getIconSVG(targetTileData);
                    triggerMysteryClear(targetTileData.id, tileObj);
                }
            }, 100);
        }
        function activateBombTile(tileObj) {
            isProcessing = true; deselectTile();
            tileObj.element.classList.add('shake-intense');
            setTimeout(() => triggerBombClear(tileObj), 800);
        }
        async function triggerBombClear(bombTileObj) {
            const matches = grid[bombTileObj.y];
            gameContainer.classList.add('screen-shake-combo'); setTimeout(() => gameContainer.classList.remove('screen-shake-combo'), 300);
            matches.forEach((cell, i) => setTimeout(() => cell.element.innerHTML = getFireSVG(), Math.abs(cell.x - bombTileObj.x) * 50));
            await new Promise(r => setTimeout(r, 600));
            score += matches.length * 30; scoreEl.innerText = score;
            checkLevelUp(); checkFireworks();
            matches.forEach(m => { m.element.innerHTML = ''; m.tileData = null; });
            await applyGravityAndRefill(); isProcessing = false;
        }
        async function triggerMysteryClear(targetId, mysteryTileObj) {
            playMassiveClearSound();
            flashOverlay.classList.add('screen-flash'); setTimeout(() => flashOverlay.classList.remove('screen-flash'), 500);
            const matches = [mysteryTileObj, ...grid.flat().filter(t => t !== mysteryTileObj && t.tileData && t.tileData.id === targetId)];
            score += matches.length * 50; scoreEl.innerText = score;
            matches.forEach(m => m.element.classList.add('match-anim'));
            await new Promise(r => setTimeout(r, 400));
            matches.forEach(m => { m.element.classList.remove('match-anim'); m.tileData = null; });
            await applyGravityAndRefill(); isProcessing = false;
        }
        function selectTile(tileObj) { selectedTile = tileObj; tileObj.element.classList.add('selected'); playTone(400, 'triangle', 0.05); }
        function deselectTile() { if (selectedTile) { selectedTile.element.classList.remove('selected'); selectedTile = null; } }
        async function swapTiles(tile1, tile2) {
            isProcessing = true; playSwapSound();
            const el1 = tile1.element; const el2 = tile2.element;
            const r1 = el1.getBoundingClientRect(); const r2 = el2.getBoundingClientRect();
            el1.style.transform = `translate(${r2.left - r1.left}px, ${r2.top - r1.top}px)`;
            el2.style.transform = `translate(${r1.left - r2.left}px, ${r1.top - r2.top}px)`;
            el1.style.transition = el2.style.transition = 'transform 0.2s ease-out';
            await new Promise(r => setTimeout(r, 200));
            el1.style.transition = el2.style.transition = el1.style.transform = el2.style.transform = '';
            
            const temp = tile1.tileData; tile1.tileData = tile2.tileData; tile2.tileData = temp;
            el1.innerHTML = getIconSVG(tile1.tileData); el2.innerHTML = getIconSVG(tile2.tileData);

            if (findMatches().length > 0) { await processMatches(findMatches(), 1); }
            else {
                playInvalidSound(); el1.classList.add('shake-anim'); el2.classList.add('shake-anim');
                const t = tile1.tileData; tile1.tileData = tile2.tileData; tile2.tileData = t;
                await new Promise(r => setTimeout(r, 200));
                el1.innerHTML = getIconSVG(tile1.tileData); el2.innerHTML = getIconSVG(tile2.tileData);
                el1.classList.remove('shake-anim'); el2.classList.remove('shake-anim');
            }
            isProcessing = false;
        }
        function findMatches() {
            let matches = new Set();
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE - 2; x++) {
                    const t1 = grid[y][x].tileData?.id; const t2 = grid[y][x+1].tileData?.id; const t3 = grid[y][x+2].tileData?.id;
                    if (t1 && t1!=='Mystery' && t1!=='Bomb' && t1===t2 && t2===t3) { matches.add(grid[y][x]); matches.add(grid[y][x+1]); matches.add(grid[y][x+2]); }
                }
            }
            for (let x = 0; x < GRID_SIZE; x++) {
                for (let y = 0; y < GRID_SIZE - 2; y++) {
                    const t1 = grid[y][x].tileData?.id; const t2 = grid[y+1][x].tileData?.id; const t3 = grid[y+2][x].tileData?.id;
                    if (t1 && t1!=='Mystery' && t1!=='Bomb' && t1===t2 && t2===t3) { matches.add(grid[y][x]); matches.add(grid[y+1][x]); matches.add(grid[y+2][x]); }
                }
            }
            return Array.from(matches);
        }
        async function applyGravityAndRefill() {
            for (let x = 0; x < GRID_SIZE; x++) {
                let writeIndex = GRID_SIZE - 1;
                for (let y = GRID_SIZE - 1; y >= 0; y--) {
                    if (grid[y][x].tileData !== null) {
                        if (writeIndex !== y) { grid[writeIndex][x].tileData = grid[y][x].tileData; grid[y][x].tileData = null; }
                        writeIndex--;
                    }
                }
                for (let y = writeIndex; y >= 0; y--) grid[y][x].tileData = getRandomTile();
            }
            for (let y = 0; y < GRID_SIZE; y++) for (let x = 0; x < GRID_SIZE; x++) grid[y][x].element.innerHTML = getIconSVG(grid[y][x].tileData);
            await new Promise(r => setTimeout(r, 200));
            const newMatches = findMatches();
            if (newMatches.length > 0) await processMatches(newMatches, 1);
        }
        async function processMatches(matches, comboCount) {
            isProcessing = true; playMatchSound(comboCount);
            if (comboCount > 1) {
                const comboDiv = document.createElement('div');
                comboDiv.innerText = `COMBO x${comboCount}!`; comboDiv.className = 'combo-text-anim';
                gridEl.appendChild(comboDiv);
            }
            matches.forEach(m => m.element.classList.add('match-anim'));
            score += matches.length * 10 * comboCount; scoreEl.innerText = score; checkLevelUp(); checkFireworks();
            await new Promise(r => setTimeout(r, 400));
            matches.forEach(m => { m.element.classList.remove('match-anim'); m.tileData = null; });
            await applyGravityAndRefill(); isProcessing = false;
        }
        function cleanInitialBoard() {
            let matches = findMatches();
            let special = grid.flat().filter(c => c.tileData && (c.tileData.id==='Mystery' || c.tileData.id==='Bomb'));
            while (matches.length > 0 || special.length > 0) {
                matches.forEach(m => m.tileData = getRandomTile());
                special.forEach(m => m.tileData = getRandomTile());
                for(let row of grid) for(let cell of row) cell.element.innerHTML = getIconSVG(cell.tileData);
                matches = findMatches();
                special = grid.flat().filter(c => c.tileData && (c.tileData.id==='Mystery' || c.tileData.id==='Bomb'));
            }
        }

        // --- END GAME & REWARD LOGIC (CRITICAL FOR LINE) ---
        function endGame() {
            clearInterval(gameInterval);
            isProcessing = true;
            
            overlayEl.classList.remove('hidden');
            startScreenContent.classList.add('hidden');
            gameOverContent.classList.remove('hidden');
            
            finalScoreEl.innerText = score;
            
            // Try saving to Firebase (if configured)
            if (window.saveScoreToFirebase) {
                window.saveScoreToFirebase(score, currentLevel, playerName);
            }

            // --- REWARD LOGIC START ---
            if (score > REWARD_SCORE_THRESHOLD) {
                claimRewardBtn.classList.remove('hidden');
                // è´äº†ä¹‹å¾Œï¼Œé è¨­çš„ OA æŒ‰éˆ•å¯ä»¥éš±è—ï¼Œé¿å…æ··æ·†ï¼Œæˆ–è€…ä¿ç•™çœ‹æ‚¨éœ€æ±‚
                // document.getElementById('oa-link-btn').classList.add('hidden'); 
            } else {
                claimRewardBtn.classList.add('hidden');
                // æ²’è´ï¼Œé¡¯ç¤ºã€Œå†ç©ä¸€æ¬¡ã€å’Œã€ŒåŠ å…¥OAã€
                // document.getElementById('oa-link-btn').classList.remove('hidden');
            }
            // --- REWARD LOGIC END ---
        }

        // --- Event Listeners ---
        startBtn.addEventListener('click', () => {
            const val = nameInput.value.trim();
            if (val) playerName = val;
            initAudio(); initGame();
        });
        restartBtn.addEventListener('click', () => {
            overlayEl.classList.remove('hidden');
            startScreenContent.classList.remove('hidden');
            gameOverContent.classList.add('hidden');
        });
        leaderboardHeader.addEventListener('click', () => {
            if (window.innerWidth >= 768) return; 
            isLeaderboardOpen = !isLeaderboardOpen;
            leaderboardSection.style.height = isLeaderboardOpen ? '320px' : '56px';
            if (isLeaderboardOpen) { leaderboardContent.classList.remove('hidden'); setTimeout(()=>leaderboardContent.classList.remove('opacity-0'),10); chevronIcon.style.transform='rotate(180deg)'; }
            else { leaderboardContent.classList.add('opacity-0'); setTimeout(()=>leaderboardContent.classList.add('hidden'),300); chevronIcon.style.transform='rotate(0deg)'; }
        });

        // --- Claim Reward Click Handler ---
        claimRewardBtn.addEventListener('click', () => {
            if (!liff.isInClient()) {
                alert('è«‹åœ¨ LINE App ä¸­é–‹å•Ÿæ­¤éŠæˆ²æ‰èƒ½é ˜å–çå‹µï¼\n(æ¸¬è©¦æ¨¡å¼ï¼šæ‚¨è´äº†ï¼)');
                return;
            }
            
            liff.sendMessages([{
                type: 'text',
                text: BOTBONNIE_KEYWORD
            }]).then(() => {
                // è¨Šæ¯ç™¼é€æˆåŠŸå¾Œï¼Œé—œé–‰è¦–çª—è®“ä½¿ç”¨è€…å›åˆ°èŠå¤©å®¤çœ‹çå‹µ
                liff.closeWindow();
            }).catch((err) => {
                console.error('Error sending message:', err);
                alert('ç™¼é€å¤±æ•—ï¼Œè«‹ç¢ºèªæ‚¨å·²æˆæ¬Šå‚³è¨ŠåŠŸèƒ½ï¼Œæˆ–æ‰‹å‹•åœ¨èŠå¤©å®¤è¼¸å…¥: ' + BOTBONNIE_KEYWORD);
            });
        });

        // Start LIFF
        initLIFF();

    </script>
</body>
</html>
