<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pantone è‰²å½©æ¥µé™æŒ‘æˆ° (Pantone Color Challenge)</title> 
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Noto Sans TC & Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- LINE LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Inter"', '"Noto Sans TC"', 'sans-serif'],
                        mono: ['"Monaco"', '"Consolas"', 'monospace'],
                    },
                    boxShadow: {
                        'card': '0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)', 
                        'card-hover': '0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22)',
                        'floating': '0 10px 40px -10px rgba(0,0,0,0.2)',
                    },
                    animation: {
                        'shake': 'shake 0.4s cubic-bezier(.36,.07,.19,.97) both',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '20%': { transform: 'translateX(-6px) rotate(-2deg)' },
                            '40%': { transform: 'translateX(6px) rotate(2deg)' },
                            '60%': { transform: 'translateX(-3px)' },
                            '80%': { transform: 'translateX(3px)' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.95)', opacity: '0.5' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        fadeIn: {
                            'from': { opacity: '0' },
                            'to': { opacity: '1' },
                        },
                        slideUp: {
                            'from': { opacity: '0', transform: 'translateY(20px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #e0e0e0; 
            -webkit-user-select: none; /* ç¦æ­¢é¸å–ï¼Œæå‡æ‰‹æ©Ÿé»æ“Šé«”é©— */
            user-select: none;
            /* ä¿®æ­£ iOS é»æ“Šé«˜äº®é¡è‰² */
            -webkit-tap-highlight-color: transparent;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .pantone-card {
            border-radius: 0 !important; 
            background-color: white;
            /* å„ªåŒ–éå ´å‹•ç•«æ›²ç·š */
            transition: transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .pantone-card-portrait {
            aspect-ratio: 2 / 3; 
        }

        /* æ‰‹æ©Ÿç‰ˆè§¸æ§åé¥‹å„ªåŒ– */
        .pantone-card:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="text-slate-900 min-h-screen flex flex-col items-center">

    <!-- Toast / Notification -->
    <div id="toast-container" class="fixed top-6 left-1/2 transform -translate-x-1/2 z-[100] w-max max-w-[90%] pointer-events-none"></div>

    <!-- å¾©æ´» Modal (2026 ä»‹ç´¹) -->
    <div id="revive-modal" class="fixed inset-0 bg-black/80 z-[90] hidden items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
        <div class="bg-white w-full max-w-md overflow-hidden shadow-2xl transform transition-all scale-100 flex flex-col max-h-[90vh]">
            <div id="revive-content" class="overflow-y-auto no-scrollbar">
                <!-- Content injected via JS -->
            </div>
            <div class="p-4 border-t border-gray-100 bg-gray-50 flex-shrink-0">
                <button id="btn-confirm-revive" class="w-full bg-black text-white font-black py-4 text-lg hover:bg-neutral-800 transition-colors flex items-center justify-center gap-2">
                    <span>æ¥é—œæŒ‘æˆ°</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Header (Sticky) -->
    <div class="sticky top-0 z-40 w-full bg-[#e0e0e0]/90 backdrop-blur-md border-b border-gray-300 transition-all duration-300" id="main-header">
        <div class="max-w-2xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="location.reload()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Pantone_logo.svg/960px-Pantone_logo.svg.png" class="h-6 w-auto object-contain" alt="Pantone Logo">
                <div class="hidden sm:block h-4 w-px bg-gray-400"></div>
                <h1 class="hidden sm:block font-bold text-sm text-gray-600 tracking-wide">COLOR CHALLENGE</h1>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- Level Indicator (Playing Mode) -->
                <div id="level-badge" class="hidden bg-black text-white px-3 py-1 text-sm font-black tracking-widest shadow-md">
                    LV.<span id="level-num">1</span>
                </div>

                <!-- Leaderboard Icon -->
                <button id="btn-header-leaderboard" class="p-2 hover:bg-gray-300 transition-colors text-gray-700 active:scale-95 transform" title="æ’è¡Œæ¦œ">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="app" class="w-full max-w-3xl px-4 py-8 flex-grow flex flex-col relative">
        <!-- Content injected via JS -->
    </div>

    <!-- Footer -->
    <footer class="w-full text-center py-6 text-gray-500 text-xs font-medium">
        Â© Pantone Color Challenge. Unofficial Fan Game.
    </footer>

    <!-- Logic -->
    <script>
        // --- Configuration & Data ---
        const LOGO_URL = "https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/Pantone_logo.svg/960px-Pantone_logo.svg.png";
        const LIFF_ID = "2008592497-pmWyN9om";
        const BOTBONNIE_URL = "https://r.botbonnie.com/P0LF4";
        
        const PANTONE_YEARS = [
            {
                year: 2026,
                name: "Cloud Dancer",
                nameCN: "é›²ä¸Šèˆç™½",
                code: "11-4201 TCX",
                hex: "#F0EFE9",
                desc: "Cloud Dancer æ˜¯ä¸€ç¨®å¤¢å¹»ã€ç©ºéˆçš„ä¹³ç™½è‰²ï¼Œè±¡å¾µè‘—ç„¡é™çš„å¯èƒ½æ€§èˆ‡è‡ªç”±ã€‚å®ƒé‚€è«‹æˆ‘å€‘æš«æ™‚è„«é›¢åœ°é¢çš„å–§å›‚ï¼Œåœ¨é›²ç«¯ç¿©ç¿©èµ·èˆï¼Œæ„Ÿå—ç´”æ·¨èˆ‡å¯§éœçš„åŠ›é‡ã€‚"
            },
            {
                year: 2025,
                name: "Mocha Mousse",
                nameCN: "æ‘©å¡æ…•æ–¯",
                code: "17-1230 TCX",
                hex: "#96786A", 
                desc: "Mocha Mousse æ˜¯ä¸€ç¨®æ¿ƒéƒã€çµ²æ»‘çš„å·§å…‹åŠ›æ£•è‰²ï¼Œå–šèµ·æº«æš–èˆ‡èˆ’é©çš„æ„Ÿå®˜é«”é©—ã€‚å®ƒæ»‹é¤Šè‘—æˆ‘å€‘å°ç°¡ç´„èˆ‡å“è³ªçš„æ¸´æœ›ï¼Œæ˜¯ä¸€ç¨®é¡ä¼¼ç”œé»èˆ¬çš„ç¸±æƒ…äº«å—ã€‚"
            },
            { year: 2024, name: "Peach Fuzz", nameCN: "æŸ”å’Œæ¡ƒ", code: "13-1023 TCX", hex: "#FFBE98", desc: "Peach Fuzz æ˜¯ä¸€ç¨®å¤©éµçµ¨èˆ¬æŸ”å’Œçš„èœœæ¡ƒè‰²ï¼Œå…¶åŒ…å®¹çš„ç²¾ç¥è±å¯Œäº†èº«å¿ƒèˆ‡éˆé­‚ã€‚" },
            { year: 2023, name: "Viva Magenta", nameCN: "è¬æ­²æ´‹ç´…", code: "18-1750 TCX", hex: "#BB2649", desc: "Viva Magenta æºè‡ªç´…è‰²å®¶æ—ï¼Œéˆæ„Ÿä¾†è‡ªèƒ­è„‚ç´…ã€‚é€™æ˜¯ä¸€ç¨®å……æ»¿æ´»åŠ›çš„è‰²å½©ï¼Œè±¡å¾µè‘—å‹‡æ•¢ã€ç„¡ç•èˆ‡å¿«æ¨‚çš„æ…¶å…¸ã€‚" },
            { year: 2022, name: "Very Peri", nameCN: "é•·æ˜¥èŠ±è—", code: "17-3938 TCX", hex: "#6667AB", desc: "Very Peri æ˜¯ç‚ºäº†æ‡‰å°è½‰è®Šä¸­çš„ä¸–ç•Œè€Œå‰µã€‚å®ƒå°‡è—è‰²çš„å¿ èª èˆ‡ç´…è‰²çš„èƒ½é‡èåˆã€‚" },
            { year: 2021, name: "Illuminating", nameCN: "äº®éº—é»ƒ", code: "13-0647 TCX", hex: "#F5DF4D", desc: "Illuminating æ˜¯ä¸€ç¨®æ˜äº®ä¸”å¿«æ´»çš„é»ƒè‰²ï¼Œé–ƒè€€è‘—æ´»åŠ›ã€‚" },
            { year: 2021, name: "Ultimate Gray", nameCN: "æ¥µè‡´ç°", code: "17-5104 TCX", hex: "#939597", desc: "Ultimate Gray è±¡å¾µè‘—å …å¯¦èˆ‡å¯é ï¼Œç¶“å¾—èµ·æ™‚é–“çš„è€ƒé©—ã€‚" },
            { year: 2020, name: "Classic Blue", nameCN: "ç¶“å…¸è—", code: "19-4052 TCX", hex: "#0F4C81", desc: "Classic Blue ç°¡ç´„è€Œå„ªé›…ï¼Œåƒæ¥µäº†è–„æš®æ™‚çš„å¤©ç©ºã€‚" },
            { year: 2019, name: "Living Coral", nameCN: "æ´»çŠç‘šæ©˜", code: "16-1546 TCX", hex: "#FF6F61", desc: "Living Coral æ•£ç™¼è‘—å¤§è‡ªç„¶ä¸­çŠç‘šç¤çš„è‰²å½©ï¼Œå……æ»¿æ´»åŠ›ã€‚" },
            { year: 2018, name: "Ultra Violet", nameCN: "ç´«å¤–å…‰", code: "18-3838 TCX", hex: "#5F4B8B", desc: "Ultra Violet å‚³é”äº†åŸå‰µæ€§ã€ç¨å‰µæ€§èˆ‡å¯Œæœ‰é è¦‹çš„æ€ç¶­ã€‚" },
            { year: 2017, name: "Greenery", nameCN: "è‰æœ¨ç¶ ", code: "15-0343 TCX", hex: "#88B04B", desc: "Greenery æ˜¯ä¸€å€‹æ¸…æ–°çš„é»ƒç¶ è‰²èª¿ï¼Œå–šèµ·åˆæ˜¥ç¹èŒ‚çš„ç¶ æ„ã€‚" },
            { year: 2016, name: "Rose Quartz", nameCN: "ç«ç‘°çŸ³è‹±ç²‰", code: "13-1520 TCX", hex: "#F7CAC9", desc: "Rose Quartz æ˜¯ä¸€ç¨®å…·èªªæœåŠ›ä½†ä¸å¤±æº«æŸ”çš„è‰²èª¿ã€‚" },
            { year: 2016, name: "Serenity", nameCN: "å¯§éœç²‰è—", code: "15-3919 TCX", hex: "#91A8D0", desc: "Serenity è¼•ç›ˆé€šé€ï¼Œåƒæ¥µäº†å»£é—Šçš„è—å¤©ã€‚" },
            { year: 2015, name: "Marsala", nameCN: "ç‘ªè–©æ‹‰é…’ç´…", code: "18-1438 TCX", hex: "#964F4C", desc: "Marsala æ˜¯ä¸€ç¨®è‡ªç„¶å¼·å‹ä¸”è³ªæ¨¸çš„é…’ç´…è‰²ã€‚" },
            { year: 2014, name: "Radiant Orchid", nameCN: "è˜­èŠ±ç´«", code: "18-3224 TCX", hex: "#B565A7", desc: "Radiant Orchid ä»¥å…¶è¿·äººçš„ç´«ç´…è‰²èª¿æ¿€ç™¼è‡ªä¿¡èˆ‡å‰µæ„ã€‚" },
            { year: 2013, name: "Emerald", nameCN: "ç¿¡ç¿ ç¶ ", code: "17-5641 TCX", hex: "#009473", desc: "Emerald æ˜¯ä¸€ç¨®ç”Ÿå‹•ã€è¼ç…Œä¸”è¯éº—çš„ç¶ è‰²ã€‚" },
            { year: 2012, name: "Tangerine Tango", nameCN: "æ¢æˆˆæ©˜", code: "17-1463 TCX", hex: "#DD4124", desc: "Tangerine Tango æ˜¯ä¸€ç¨®å……æ»¿æŒ‘é€—æ€§çš„æ©˜ç´…è‰²ã€‚" },
            { year: 2011, name: "Honeysuckle", nameCN: "å¿å†¬ç´…", code: "18-2120 TCX", hex: "#D65076", desc: "Honeysuckle æ˜¯ä¸€ç¨®å‹‡æ•¢çš„æ–°ç´…è‰²ã€‚" },
            { year: 2010, name: "Turquoise", nameCN: "åœŸè€³å…¶è—", code: "15-5519 TCX", hex: "#45B5AA", desc: "Turquoise çµåˆäº†è—è‰²çš„å¯§éœèˆ‡ç¶ è‰²çš„æ´»åŠ›ã€‚" },
            { year: 2009, name: "Mimosa", nameCN: "å«ç¾è‰é»ƒ", code: "14-0848 TCX", hex: "#EFC050", desc: "Mimosa æ˜¯ä¸€ç¨®æº«æš–ä¸”å¼•äººå…¥å‹çš„é»ƒè‰²ã€‚" },
            { year: 2008, name: "Blue Iris", nameCN: "é³¶å°¾è—", code: "18-3943 TCX", hex: "#5A5B9F", desc: "Blue Iris çµåˆäº†è—è‰²çš„ç©©å®šèˆ‡ç´«è‰²çš„ç¥ç§˜ã€‚" },
            { year: 2007, name: "Chili Pepper", nameCN: "è¾£æ¤’ç´…", code: "19-1557 TCX", hex: "#9B1B30", desc: "Chili Pepper æ˜¯ä¸€ç¨®æ·±æ²ˆçš„è¾›è¾£ç´…è‰²ï¼Œå¤§è†½ã€å¤–å‘ä¸”è‡ªä¿¡ã€‚" },
            { year: 2006, name: "Sand Dollar", nameCN: "æ²™å¹£è¤", code: "13-1106 TCX", hex: "#DECDBE", desc: "Sand Dollar æ˜¯ä¸€ç¨®è¢«èªç‚ºæ˜¯è‡ªç„¶èˆ‡æœ‰æ©Ÿçš„è‰²èª¿ã€‚" },
            { year: 2005, name: "Blue Turquoise", nameCN: "è—ç¶ æ¾çŸ³", code: "15-5217 TCX", hex: "#53B0AE", desc: "Blue Turquoise æ¯”èµ·ä¸€èˆ¬çš„ç¶ æ¾çŸ³è‰²å«æœ‰æ›´å¤šçš„è—è‰²èª¿ã€‚" },
            { year: 2004, name: "Tigerlily", nameCN: "è™çš®ç™¾åˆæ©˜", code: "17-1456 TCX", hex: "#E2583E", desc: "Tigerlily åŒ…å«äº†ç´…èˆ‡é»ƒï¼Œå……æ»¿ç•°åœ‹æƒ…èª¿ã€‚" },
            { year: 2003, name: "Aqua Sky", nameCN: "æ°´è‰²å¤©ç©º", code: "14-4811 TCX", hex: "#7BC4C4", desc: "Aqua Sky æ˜¯ä¸€ç¨®æŸ”å’Œã€å¯§éœçš„è—ç¶ è‰²ã€‚" },
            { year: 2002, name: "True Red", nameCN: "æ­£ç´…", code: "19-1664 TCX", hex: "#BF1932", desc: "True Red æ˜¯ä¸€ç¨®å¼·çƒˆä¸”å¯Œæœ‰åŠ›é‡çš„ç´…è‰²ã€‚" },
            { year: 2001, name: "Fuchsia Rose", nameCN: "æ¡ƒç´…ç«ç‘°", code: "17-2031 TCX", hex: "#C74375", desc: "Fuchsia Rose æ˜¯ä¸€ç¨®å……æ»¿å¥³æ€§é­…åŠ›ä¸”ç†±æƒ…çš„è‰²å½©ã€‚" },
            { year: 2000, name: "Cerulean", nameCN: "è”šè—", code: "15-4020 TCX", hex: "#98B2D1", desc: "Cerulean ä»£è¡¨è‘—åƒç¦§å¹´çš„å¤©ç©ºè‰²å½©ã€‚" },
        ];

        // --- Game State ---
        const state = {
            view: 'home', // home, intro, playing, gameover, leaderboard
            level: 1,
            currentBase: PANTONE_YEARS[0],
            introBase: null, // For year selection viewing
            oddColor: "",
            oddIndex: 0,
            wrongIndex: -1, 
            showFeedback: false, 
            hasRevived: false,
            failedDetails: { baseHex: '', oddHex: '', difference: 0 }
        };

        // --- Helper Functions ---
        const hexToRgb = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : { r: 0, g: 0, b: 0 };
        };

        const rgbToHex = (r, g, b) => {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        };

        const getColorDifference = (hex1, hex2) => {
            const rgb1 = hexToRgb(hex1);
            const rgb2 = hexToRgb(hex2);
            const diffSq = Math.pow(rgb1.r - rgb2.r, 2) + Math.pow(rgb1.g - rgb2.g, 2) + Math.pow(rgb1.b - rgb2.b, 2);
            const maxDiff = 441.67;
            return ((Math.sqrt(diffSq) / maxDiff) * 100).toFixed(2);
        };

        const generateVariantColor = (baseHex, level) => {
            const rgb = hexToRgb(baseHex);
            let difficulty = Math.max(1.8, 30 - (level * 1.5)); 
            
            const change = (val) => {
                const direction = Math.random() > 0.5 ? 1 : -1;
                let newVal = val + (difficulty * direction);
                if (newVal > 255) newVal = val - difficulty;
                if (newVal < 0) newVal = val + difficulty; 
                if (Math.abs(newVal - val) < 3) newVal = val + (direction * 5); 
                return Math.floor(Math.max(0, Math.min(255, newVal)));
            };

            return rgbToHex(change(rgb.r), change(rgb.g), change(rgb.b));
        };

        const getRankTitle = (level) => {
            if (level < 5) return "è‰²å½©å­¸å¾’";
            if (level < 10) return "è¨­è¨ˆåŠ©ç†";
            if (level < 15) return "è³‡æ·±è¨­è¨ˆå¸«";
            if (level < 20) return "è—è¡“ç¸½ç›£";
            if (level < 30) return "å°åˆ·å» å¸«å‚…";
            return "çµ•å°è‰²æ„Ÿç¥äºº";
        };

        const showToast = (message, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgClass = type === 'error' ? 'bg-red-500' : 'bg-black';
            toast.className = `${bgClass} text-white px-6 py-3 shadow-2xl flex items-center gap-3 animate-slide-up mb-2 mx-auto w-fit z-50`;
            toast.innerHTML = `<span class="font-bold text-sm tracking-wide">${message}</span>`;
            
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        };

        // --- Local Storage ---
        const SCORE_KEY = 'pantone_game_scores_v2';
        const getScores = () => {
            try { return JSON.parse(localStorage.getItem(SCORE_KEY)) || []; } catch { return []; }
        };
        const saveScore = (score) => {
            const scores = getScores();
            scores.push({ score, rankTitle: getRankTitle(score + 1), date: new Date().toLocaleDateString() });
            scores.sort((a, b) => b.score - a.score);
            localStorage.setItem(SCORE_KEY, JSON.stringify(scores.slice(0, 5)));
        };

        // --- Core Game Logic ---
        const startRound = (specificBase = null) => {
            const base = specificBase || PANTONE_YEARS[Math.floor(Math.random() * PANTONE_YEARS.length)];
            state.currentBase = base;
            state.oddColor = generateVariantColor(base.hex, state.level);
            state.oddIndex = Math.floor(Math.random() * 4);
            state.wrongIndex = -1;
            state.showFeedback = false;
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const startRandomGame = () => {
            state.level = 1;
            state.hasRevived = false;
            state.view = 'playing';
            startRound();
        };

        const startGameFromIntro = () => {
            state.level = 1;
            state.hasRevived = false;
            state.view = 'playing';
            startRound(state.introBase);
        };

        const handleCardClick = (index) => {
            if (state.showFeedback || state.wrongIndex !== -1) return; 

            if (index === state.oddIndex) {
                state.level++;
                if (navigator.vibrate) navigator.vibrate(50);
                
                const card = document.querySelector(`[data-card-index="${index}"]`);
                if(card) {
                    const overlay = document.createElement('div');
                    overlay.className = "absolute inset-0 z-20 flex items-center justify-center animate-pop";
                    overlay.innerHTML = `<div class="bg-green-500/90 text-white p-3 shadow-lg rounded-full"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>`;
                    card.appendChild(overlay);
                }

                setTimeout(() => startRound(), 400); 
            } else {
                state.failedDetails = {
                    baseHex: state.currentBase.hex,
                    oddHex: state.oddColor,
                    difference: getColorDifference(state.currentBase.hex, state.oddColor)
                };

                if (!state.hasRevived) {
                    // Waiting for potential revive
                } else {
                    saveScore(state.level - 1);
                }

                if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
                state.wrongIndex = index; 
                state.showFeedback = true; 
                render(); 
                
                setTimeout(() => {
                    state.view = 'gameover';
                    render();
                }, 1200);
            }
        };

        // --- Revive Logic ---
        const openReviveModal = () => {
            const modal = document.getElementById('revive-modal');
            const content = document.getElementById('revive-content');
            const p2026 = PANTONE_YEARS.find(p => p.year === 2026);

            content.innerHTML = `
                <div class="bg-white">
                    <div class="h-64 w-full relative" style="background-color: ${p2026.hex}">
                        <div class="absolute top-4 left-4 bg-black/90 text-white text-[10px] px-3 py-1.5 uppercase tracking-wider font-bold">2026 Color of the Year</div>
                    </div>
                    <div class="p-8">
                         <img src="${LOGO_URL}" class="h-6 mb-6 opacity-80" />
                         <h2 class="text-4xl font-black text-gray-900 mb-2 leading-none">${p2026.name}</h2>
                         <h3 class="text-xl font-bold text-gray-500 mb-6">${p2026.nameCN} <span class="text-sm font-mono text-gray-300 ml-2">${p2026.code}</span></h3>
                         <p class="text-gray-600 leading-relaxed text-justify mb-4">${p2026.desc}</p>
                         <div class="bg-gray-100 p-4 text-xs text-gray-500 font-mono">
                            ç¾åœ¨ï¼Œå¸¶è‘—é€™ä»½è‰²å½©çš„èƒ½é‡é‡è¿”æŒ‘æˆ°å§ï¼
                         </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };

        const confirmRevive = () => {
            const modal = document.getElementById('revive-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            
            // Execute Revive
            state.hasRevived = true;
            state.view = 'playing';
            startRound(state.currentBase);
        };

        // BotBonnie Share Revive Handler
        const handleShareRevive = () => {
            if (!liff.isLoggedIn()) {
                liff.login();
                return;
            }

            // Open external link
            liff.openWindow({
                url: BOTBONNIE_URL,
                external: true
            });

            // Optimistic Revive: Assume user shared/completed action and grant revive immediately
            // This ensures smooth UX when they return to the app
            setTimeout(() => {
                confirmRevive();
            }, 500);
        };

        // --- Render Functions ---
        
        // 1. Home View
        const renderHome = () => {
            const currentYearColor = PANTONE_YEARS.find(p => p.year === 2026);
            const pastYearsColors = PANTONE_YEARS.filter(p => p.year !== 2026);

            // Template for 2026 (Landscape)
            // Mobile Fix: Added h-48 to image container to prevent collapse on flex-col
            const templateLandscape = (p) => `
                <div data-action="intro" data-year="${p.year}" data-name="${p.name}" 
                     class="pantone-card w-full mb-8 shadow-card hover:shadow-card-hover cursor-pointer group flex flex-col md:flex-row transform hover:-translate-y-1 h-auto md:h-64">
                    
                    <div class="w-full h-48 md:h-auto md:w-[65%] relative" style="background-color: ${p.hex}">
                        <div class="absolute top-6 left-6 bg-black text-white text-[10px] px-3 py-1 font-bold uppercase tracking-wider">2026 New Arrival</div>
                        <div class="absolute bottom-4 right-4 text-white/40 text-sm font-black tracking-widest uppercase md:hidden">2026</div>
                    </div>

                    <div class="flex-1 bg-white p-6 md:p-8 flex flex-col justify-center text-left relative z-10">
                        <img src="${LOGO_URL}" class="h-6 w-auto object-contain object-left mb-6 opacity-80" alt="Pantone">
                        
                        <div class="mb-1 font-mono font-bold text-gray-400 text-sm">${p.code}</div>
                        <div class="text-3xl font-black text-gray-900 leading-none mb-2 tracking-tight">${p.name}</div>
                        <div class="text-xl font-bold text-gray-500">${p.nameCN}</div>
                        <div class="mt-6 flex items-center text-xs font-bold text-gray-400 gap-2 group-hover:text-black transition-colors">
                            <span>äº†è§£æ›´å¤š</span>
                            <span class="group-hover:translate-x-1 transition-transform">â†’</span>
                        </div>
                    </div>
                </div>
            `;

            // Template for 2025 and older (Portrait, No Rounded Corners, Specific Ratio)
            const templatePortrait = (p) => `
                <div data-action="intro" data-year="${p.year}" data-name="${p.name}" 
                     class="pantone-card pantone-card-portrait bg-white shadow-card hover:shadow-card-hover cursor-pointer group flex flex-col transform hover:-translate-y-1">
                    
                    <!-- Color Area: approx 65% height -->
                    <div class="w-full h-[65%] relative" style="background-color: ${p.hex}">
                         <div class="absolute bottom-3 right-3 bg-white/20 backdrop-blur-sm text-white/90 text-[10px] px-2 py-0.5 font-bold uppercase tracking-wider">${p.year}</div>
                    </div>

                    <!-- Info Area: approx 35% height -->
                    <div class="flex-1 bg-white p-4 flex flex-col justify-end text-left relative z-10 border-t border-gray-100/50">
                        <img src="${LOGO_URL}" class="h-4 w-auto object-contain object-left mb-auto opacity-70 mt-1" alt="Pantone">
                        
                        <div class="mt-3">
                            <div class="text-[10px] font-bold text-gray-400 font-mono mb-0.5">${p.code}</div>
                            <div class="text-base font-black text-gray-900 leading-none tracking-tight mb-1 truncate">${p.name}</div>
                            <div class="text-xs font-bold text-gray-500 truncate">${p.nameCN}</div>
                        </div>
                    </div>
                </div>
            `;

            return `
                <div class="animate-fade-in pb-10 max-w-5xl mx-auto">
                    <!-- Hero Section -->
                    <div class="text-center mb-10 mt-4">
                        <h2 class="text-4xl md:text-6xl font-black text-slate-800 tracking-tighter mb-4">è‰²å½©æ¥µé™æŒ‘æˆ°</h2>
                        <div class="w-16 h-1 bg-black mx-auto mb-4"></div>
                        <p class="text-slate-500 font-medium tracking-wide">PANTONE COLOR CHALLENGE</p>
                    </div>

                    <!-- Start Button -->
                    <button id="btn-random" class="w-full max-w-md mx-auto bg-black text-white p-5 shadow-xl hover:bg-neutral-800 transition-all flex items-center justify-between group mb-16 relative overflow-hidden active:scale-95">
                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></div>
                        <div class="flex flex-col text-left">
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">IMMEDIATE START</span>
                            <span class="text-xl font-black flex items-center gap-2">
                                éš¨æ©Ÿé–‹å§‹æŒ‘æˆ° 
                                <span class="bg-white text-black text-xs px-2 py-0.5 font-bold">PLAY</span>
                            </span>
                        </div>
                        <svg class="w-6 h-6 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </button>

                    <!-- Section Header -->
                    <div class="flex items-center gap-4 mb-8">
                        <div class="h-4 w-1 bg-black"></div>
                        <span class="text-lg font-black text-black uppercase tracking-tight">é¸æ“‡ PANTONE å¹´åº¦ä»£è¡¨è‰²</span>
                    </div>

                    <!-- 2026 Special Landscape Card -->
                    ${templateLandscape(currentYearColor)}

                    <!-- Past Years Grid (Portrait) -->
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8">
                        ${pastYearsColors.map(p => templatePortrait(p)).join('')}
                    </div>
                </div>
            `;
        };

        // 2. Intro View (Detail Page)
        const renderIntro = () => {
            const p = state.introBase || state.currentBase;
            return `
                <div class="animate-fade-in flex flex-col h-full max-w-md mx-auto">
                    <div class="bg-white shadow-2xl overflow-hidden relative flex-grow flex flex-col">
                        <button id="btn-intro-close" class="absolute top-4 right-4 z-20 bg-white/50 backdrop-blur hover:bg-white text-black rounded-full p-2 transition-all active:scale-90">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                        
                        <div class="h-[50vh] w-full relative" style="background-color: ${p.hex}">
                            <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"></div>
                        </div>
                        
                        <div class="p-8 flex-1 flex flex-col bg-white">
                            <img src="${LOGO_URL}" class="h-6 w-auto object-contain object-left mb-8 opacity-80" alt="Pantone">
                            
                            <h1 class="text-5xl font-black text-slate-900 mb-2 leading-none tracking-tight">${p.name}</h1>
                            <div class="flex flex-col mb-8 border-l-4 border-gray-900 pl-4 py-1">
                                <h2 class="text-2xl font-bold text-slate-500">${p.nameCN}</h2>
                                <span class="font-mono font-bold text-slate-300 text-sm mt-1">${p.code}</span>
                            </div>
                            
                            <div class="prose prose-sm text-slate-600 font-medium leading-relaxed text-justify mb-8">
                                ${p.desc}
                            </div>

                            <button id="btn-start-challenge" class="mt-auto w-full bg-black text-white py-5 font-black text-xl hover:bg-neutral-800 transition-all shadow-lg active:scale-[0.98] flex items-center justify-center gap-3">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                START CHALLENGE
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        // 3. Playing View
        const renderPlaying = () => {
            let cardsHtml = '';
            // Generate 4 cards
            for (let i = 0; i < 4; i++) {
                const isOdd = i === state.oddIndex;
                const isWrong = i === state.wrongIndex;
                const displayHex = isOdd ? state.oddColor : state.currentBase.hex;
                
                let overlay = '';
                if (state.showFeedback) {
                     if (isOdd) {
                        overlay = `<div class="absolute inset-0 z-20 flex items-center justify-center bg-black/10"><div class="bg-white text-black px-4 py-2 font-bold shadow-lg text-xs animate-pop">ANSWER</div></div>`;
                     } else if (isWrong) {
                         overlay = `<div class="absolute inset-0 z-20 flex items-center justify-center bg-red-500/20"><svg class="w-12 h-12 text-red-600 animate-pop" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div>`;
                     }
                }

                // Also apply sharp corners to game cards for consistency
                cardsHtml += `
                    <div data-card-index="${i}" class="pantone-card pantone-card-portrait bg-white shadow-card cursor-pointer relative flex flex-col group active:scale-[0.98] transition-transform ${isWrong ? 'animate-shake' : ''}">
                        ${overlay}
                        <div class="w-full h-[65%] relative" style="background-color: ${displayHex}"></div>
                        <div class="flex-1 bg-white p-3 md:p-4 flex flex-col justify-end text-left select-none relative z-10">
                            <img src="${LOGO_URL}" class="h-3 md:h-4 w-auto object-contain object-left mb-auto opacity-60" alt="Pantone">
                            <div class="mt-2">
                                <div class="text-[10px] font-bold text-gray-400 font-mono mb-0.5">${state.currentBase.code}</div>
                                <div class="text-sm md:text-base font-black text-gray-900 leading-tight truncate">${state.currentBase.name}</div>
                                <div class="text-[10px] font-bold text-gray-400 mt-0.5">${state.currentBase.nameCN}</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="animate-fade-in w-full h-full flex flex-col max-w-md mx-auto">
                    <!-- Question Header -->
                    <div class="text-center mb-4 md:mb-6 mt-2">
                        <div class="inline-block bg-white px-6 py-3 shadow-sm border border-gray-200">
                            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">MISSION</p>
                            <p class="text-base md:text-lg font-bold text-slate-800">
                                è«‹å•å“ªä¸€å€‹é¡è‰²<span class="text-red-500 font-black mx-1">ä¸æ˜¯</span> ${state.currentBase.nameCN}ï¼Ÿ
                            </p>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 md:gap-6 w-full pb-4">
                        ${cardsHtml}
                    </div>
                </div>
            `;
        };

        // 4. Game Over View
        const renderGameOver = () => {
            const f = state.failedDetails;
            const currentTitle = getRankTitle(state.level); // ç²å–ç•¶å‰ç¨±è™Ÿ
            
            // Revive Button logic
            let reviveBtn = '';
            if (!state.hasRevived) {
                // Show BOTH revive options
                reviveBtn = `
                    <div class="flex flex-col gap-3 mb-6">
                        <button id="btn-share-revive" class="w-full bg-[#06C755] text-white py-4 font-bold shadow-lg hover:bg-[#05b34d] transition-all flex items-center justify-center gap-2 active:scale-[0.98]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                            <span>åˆ†äº«å¥½å‹æ¥é—œ (å‰å¾€é›†é»)</span>
                        </button>

                        <button id="btn-trigger-revive" class="w-full bg-indigo-600 text-white py-4 font-bold shadow-lg hover:bg-indigo-700 transition-all flex items-center justify-center gap-2 active:scale-[0.98]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                            <span>äº†è§£ 2026 Cloud Dancer æ¥é—œ</span>
                        </button>
                        <p class="text-[10px] text-gray-400 mt-1">æ¯å±€åƒ…é™é¸æ“‡ä¸€ç¨®æ–¹å¼æ¥é—œä¸€æ¬¡</p>
                    </div>
                `;
            } else {
                 reviveBtn = `
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-6">æ¥é—œæ©Ÿæœƒå·²ç”¨ç›¡</div>
                 `;
            }

            return `
                <div class="animate-fade-in w-full max-w-md mx-auto bg-white shadow-2xl overflow-hidden border-t-8 border-black">
                    <div class="p-8 text-center">
                        <div class="w-20 h-20 bg-gray-100 flex items-center justify-center mx-auto mb-6 text-4xl shadow-inner border border-gray-200">ğŸ†</div>
                        
                        <h2 class="text-3xl font-black text-slate-900 mb-1 uppercase tracking-tight">Game Over</h2>
                        
                        <!-- ç¨±è™Ÿé¡¯ç¤ºå€åŸŸ -->
                        <div class="my-6 py-4 bg-gray-50 border border-gray-100 relative">
                            <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">ç²å¾—ç¨±è™Ÿ (Rank)</div>
                            <div class="text-2xl font-black text-indigo-600">${currentTitle}</div>
                            <div class="text-sm font-bold text-slate-400 mt-1">Level ${state.level}</div>
                        </div>

                        ${reviveBtn}

                        <div class="bg-slate-50 p-5 text-left mb-6 border-l-4 border-red-500 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-xs font-bold text-gray-400 uppercase">Analysis</span>
                                <span class="text-xs font-bold text-red-500">å·®ç•°åº¦ ${f.difference}%</span>
                            </div>
                            
                            <div class="flex items-center gap-4">
                                <div class="flex flex-col items-center gap-1">
                                    <div class="w-12 h-12 shadow-sm border border-gray-200" style="background-color: ${f.oddHex}"></div>
                                    <span class="text-[10px] font-bold text-gray-500">è©²é¡Œè®Šç•°è‰²</span>
                                </div>
                                <div class="flex-1 h-px bg-gray-300 relative">
                                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white px-2 text-[10px] text-gray-400 font-mono">VS</div>
                                </div>
                                <div class="flex flex-col items-center gap-1">
                                    <div class="w-12 h-12 shadow-sm border border-gray-200" style="background-color: ${f.baseHex}"></div>
                                    <span class="text-[10px] font-bold text-gray-500">æ­£ç¢ºåŸè‰²</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button id="btn-restart" class="flex-1 bg-black text-white py-3 font-bold hover:bg-neutral-800 transition-colors active:scale-[0.98]">
                                é‡æ–°æŒ‘æˆ°
                            </button>
                            <button id="btn-leaderboard" class="w-14 bg-gray-100 text-black py-3 font-bold hover:bg-gray-200 transition-colors flex items-center justify-center active:scale-[0.98]">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };

        // 5. Leaderboard View
        const renderLeaderboard = () => {
            const scores = getScores();
            const listHtml = scores.length ? scores.map((s, i) => `
                <div class="flex items-center justify-between py-4 border-b border-gray-100 last:border-0">
                    <div class="flex items-center gap-4">
                        <span class="w-6 text-center font-black text-gray-300 italic text-lg">${i+1}</span>
                        <div>
                            <div class="font-bold text-slate-800">${s.rankTitle}</div>
                            <div class="text-[10px] text-gray-400 font-mono">${s.date}</div>
                        </div>
                    </div>
                    <div class="font-black text-xl text-black">${s.score} <span class="text-xs font-normal text-gray-400">åˆ†</span></div>
                </div>
            `).join('') : `<div class="py-12 text-center text-gray-400">å°šç„¡ç´€éŒ„ï¼Œå¿«å»æŒ‘æˆ°å§ï¼</div>`;

            return `
                <div class="animate-fade-in w-full max-w-md mx-auto">
                    <div class="bg-white shadow-xl overflow-hidden border-t-8 border-black">
                        <div class="bg-white p-6 border-b border-gray-100 flex justify-between items-end">
                            <h2 class="text-2xl font-black uppercase text-black">Leaderboard</h2>
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                        </div>
                        <div class="p-6">
                            ${listHtml}
                        </div>
                        <div class="p-4 bg-gray-50 border-t border-gray-100">
                            <button id="btn-back" class="w-full py-3 bg-white border border-gray-300 font-bold hover:bg-gray-100 transition active:scale-[0.98]">è¿”å›</button>
                        </div>
                    </div>
                </div>
            `;
        };

        // --- Controller ---
        const render = () => {
            const app = document.getElementById('app');
            const header = document.getElementById('main-header');
            const levelBadge = document.getElementById('level-badge');
            const levelNum = document.getElementById('level-num');
            const headerLeaderboard = document.getElementById('btn-header-leaderboard');

            // Header state
            if (state.view === 'playing') {
                levelBadge.classList.remove('hidden');
                levelNum.textContent = state.level;
                headerLeaderboard.classList.add('hidden');
            } else {
                levelBadge.classList.add('hidden');
                headerLeaderboard.classList.remove('hidden');
            }

            // Render view
            switch(state.view) {
                case 'home': app.innerHTML = renderHome(); break;
                case 'intro': app.innerHTML = renderIntro(); break;
                case 'playing': app.innerHTML = renderPlaying(); break;
                case 'gameover': app.innerHTML = renderGameOver(); break;
                case 'leaderboard': app.innerHTML = renderLeaderboard(); break;
            }

            bindEvents();
        };

        const bindEvents = () => {
            // Home
            document.getElementById('btn-random')?.addEventListener('click', startRandomGame);
            document.querySelectorAll('.pantone-card[data-action="intro"]').forEach(card => {
                card.addEventListener('click', () => {
                    const year = parseInt(card.dataset.year);
                    const name = card.dataset.name;
                    state.introBase = PANTONE_YEARS.find(p => p.year === year && p.name === name);
                    state.view = 'intro';
                    render();
                    window.scrollTo(0,0);
                });
            });

            // Intro
            document.getElementById('btn-intro-close')?.addEventListener('click', () => {
                state.view = 'home';
                render();
            });
            document.getElementById('btn-start-challenge')?.addEventListener('click', startGameFromIntro);

            // Playing
            document.querySelectorAll('.pantone-card[data-card-index]').forEach(card => {
                card.addEventListener('click', () => handleCardClick(parseInt(card.dataset.cardIndex)));
            });

            // Game Over
            document.getElementById('btn-restart')?.addEventListener('click', () => {
                state.view = 'home';
                render();
            });
            document.getElementById('btn-leaderboard')?.addEventListener('click', () => {
                state.view = 'leaderboard';
                render();
            });
            
            // Revive Triggers
            document.getElementById('btn-trigger-revive')?.addEventListener('click', openReviveModal);
            document.getElementById('btn-share-revive')?.addEventListener('click', handleShareRevive);

            // Leaderboard
            document.getElementById('btn-back')?.addEventListener('click', () => {
                state.view = 'home';
                render();
            });
        };

        // Header Buttons
        document.getElementById('btn-header-leaderboard').addEventListener('click', () => {
            state.view = 'leaderboard';
            render();
        });

        // Revive Modal Confirm
        document.getElementById('btn-confirm-revive').addEventListener('click', confirmRevive);

        // Init LIFF & Game
        window.onload = function() {
            // Init Game UI
            render();

            // Init LIFF
            if (liff) {
                liff.init({ liffId: LIFF_ID })
                    .then(() => {
                        console.log("LIFF Initialized");
                        if (!liff.isLoggedIn()) {
                            // Optional: Auto login or wait for user action
                            // liff.login(); 
                        }
                    })
                    .catch((err) => {
                        console.error("LIFF Init Failed", err);
                    });
            }
        };

    </script>
</body>
</html>
