<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pantone 色彩極限挑戰 (Pantone Color Challenge)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Noto Sans TC Font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F0F0F0;
        }

        /* Custom Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-6px) rotate(-2deg); }
            40% { transform: translateX(6px) rotate(2deg); }
            60% { transform: translateX(-3px); }
            80% { transform: translateX(3px); }
        }
        .animate-shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes pulse-fast {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .animate-pulse-fast {
            animation: pulse-fast 0.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.3s ease-out forwards;
        }

        /* Utility for hiding elements */
        .hidden { display: none !important; }
    </style>
</head>
<body class="text-slate-900 min-h-screen flex flex-col items-center py-6 px-4">

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 z-50"></div>

    <!-- Header -->
    <div class="w-full max-w-lg flex justify-between items-end mb-8 border-b-4 border-black pb-4">
        <div class="flex flex-col">
            <div class="bg-black text-white px-2 py-1 font-black text-xs md:text-sm tracking-[0.2em] w-fit mb-2">PANTONE</div>
            <h1 class="font-black text-2xl md:text-3xl tracking-tighter leading-tight text-black">
                Pantone 色彩極限挑戰<br/>
                <span class="text-base md:text-lg font-bold text-gray-500 tracking-normal block mt-1">Color Challenge</span>
            </h1>
        </div>
        <div id="level-indicator" class="flex flex-col items-end hidden">
            <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">Level</span>
            <span id="level-display" class="text-4xl font-black leading-none text-black">1</span>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="app" class="w-full max-w-lg relative min-h-[600px]">
        <!-- Content will be injected here by JavaScript -->
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Data ---
        const PANTONE_YEARS = [
            {
                year: 2025,
                name: "Mocha Mousse",
                nameCN: "摩卡慕斯",
                code: "17-1230",
                hex: "#96786A", 
                desc: "Mocha Mousse 是一種濃郁、絲滑的巧克力棕色，喚起溫暖與舒適的感官體驗。它滋養著我們對簡約與品質的渴望，是一種類似甜點般的縱情享受，帶來極致的舒適感。"
            },
            { year: 2024, name: "Peach Fuzz", nameCN: "柔和桃", code: "13-1023", hex: "#FFBE98", desc: "Peach Fuzz 是一種天鵝絨般柔和的蜜桃色，其包容的精神豐富了身心與靈魂。" },
            { year: 2023, name: "Viva Magenta", nameCN: "萬歲洋紅", code: "18-1750", hex: "#BB2649", desc: "Viva Magenta 源自紅色家族，靈感來自胭脂紅。這是一種充滿活力的色彩，象徵著勇敢、無畏與快樂的慶典。" },
            { year: 2022, name: "Very Peri", nameCN: "長春花藍", code: "17-3938", hex: "#6667AB", desc: "Very Peri 是為了應對轉變中的世界而創。它將藍色的忠誠與紅色的能量融合，創造出一種快樂、溫暖的紫藍色。" },
            { year: 2021, name: "Illuminating", nameCN: "亮麗黃", code: "13-0647", hex: "#F5DF4D", desc: "Illuminating 是一種明亮且快活的黃色，閃耀著活力，彷彿注滿了太陽的能量。" },
            { year: 2021, name: "Ultimate Gray", nameCN: "極致灰", code: "17-5104", hex: "#939597", desc: "Ultimate Gray 象徵著堅實與可靠，如同海灘上的石子，經得起時間的考驗。" },
            { year: 2020, name: "Classic Blue", nameCN: "經典藍", code: "19-4052", hex: "#0F4C81", desc: "Classic Blue 簡約而優雅，像極了薄暮時的天空。它帶來和平與寧靜的感覺。" },
            { year: 2019, name: "Living Coral", nameCN: "活珊瑚橘", code: "16-1546", hex: "#FF6F61", desc: "Living Coral 散發著大自然中珊瑚礁的色彩，充滿活力卻又醇厚。" },
            { year: 2018, name: "Ultra Violet", nameCN: "紫外光", code: "18-3838", hex: "#5F4B8B", desc: "Ultra Violet 傳達了原創性、獨創性與富有遠見的思維。這種複雜的紫色調指向了宇宙的神秘。" },
            { year: 2017, name: "Greenery", nameCN: "草木綠", code: "15-0343", hex: "#88B04B", desc: "Greenery 是一個清新的黃綠色調，喚起初春繁茂的綠意。" },
            { year: 2016, name: "Rose Quartz", nameCN: "玫瑰石英粉", code: "13-1520", hex: "#F7CAC9", desc: "Rose Quartz 是一種具說服力但不失溫柔的色調，傳達同情與鎮定。" },
            { year: 2016, name: "Serenity", nameCN: "寧靜粉藍", code: "15-3919", hex: "#91A8D0", desc: "Serenity 輕盈通透，像極了廣闊的藍天。它帶給人們喘息的空間與放鬆感。" },
            { year: 2015, name: "Marsala", nameCN: "瑪薩拉酒紅", code: "18-1438", hex: "#964F4C", desc: "Marsala 是一種自然強勁且質樸的酒紅色。它豐富了我們的身心靈。" },
            { year: 2014, name: "Radiant Orchid", nameCN: "蘭花紫", code: "18-3224", hex: "#B565A7", desc: "Radiant Orchid 以其迷人的紫紅色調激發自信與創意。" },
            { year: 2013, name: "Emerald", nameCN: "翡翠綠", code: "17-5641", hex: "#009473", desc: "Emerald 是一種生動、輝煌且華麗的綠色。它增強了幸福感與平衡感。" },
            { year: 2012, name: "Tangerine Tango", nameCN: "探戈橘", code: "17-1463", hex: "#DD4124", desc: "Tangerine Tango 是一種充滿挑逗性的橘紅色。它散發著熱力與能量。" },
            { year: 2011, name: "Honeysuckle", nameCN: "忍冬紅", code: "18-2120", hex: "#D65076", desc: "Honeysuckle 是一種勇敢的新紅色，給予我們面對日常生活的勇氣。" },
            { year: 2010, name: "Turquoise", nameCN: "土耳其藍", code: "15-5519", hex: "#45B5AA", desc: "Turquoise 結合了藍色的寧靜與綠色的活力。" },
            { year: 2009, name: "Mimosa", nameCN: "含羞草黃", code: "14-0848", hex: "#EFC050", desc: "Mimosa 是一種溫暖且引人入勝的黃色。" },
            { year: 2008, name: "Blue Iris", nameCN: "鳶尾藍", code: "18-3943", hex: "#5A5B9F", desc: "Blue Iris 結合了藍色的穩定與紫色的神秘。" },
            { year: 2007, name: "Chili Pepper", nameCN: "辣椒紅", code: "19-1557", hex: "#9B1B30", desc: "Chili Pepper 是一種深沈的辛辣紅色，大膽、外向且自信。" },
            { year: 2006, name: "Sand Dollar", nameCN: "沙幣褐", code: "13-1106", hex: "#DECDBE", desc: "Sand Dollar 是一種被認為是自然與有機的色調。" },
            { year: 2005, name: "Blue Turquoise", nameCN: "藍綠松石", code: "15-5217", hex: "#53B0AE", desc: "Blue Turquoise 比起一般的綠松石色含有更多的藍色調。" },
            { year: 2004, name: "Tigerlily", nameCN: "虎皮百合橘", code: "17-1456", hex: "#E2583E", desc: "Tigerlily 包含了紅與黃，充滿異國情調。" },
            { year: 2003, name: "Aqua Sky", nameCN: "水色天空", code: "14-4811", hex: "#7BC4C4", desc: "Aqua Sky 是一種柔和、寧靜的藍綠色。" },
            { year: 2002, name: "True Red", nameCN: "正紅", code: "19-1664", hex: "#BF1932", desc: "True Red 是一種強烈且富有力量的紅色。" },
            { year: 2001, name: "Fuchsia Rose", nameCN: "桃紅玫瑰", code: "17-2031", hex: "#C74375", desc: "Fuchsia Rose 是一種充滿女性魅力且熱情的色彩。" },
            { year: 2000, name: "Cerulean", nameCN: "蔚藍", code: "15-4020", hex: "#98B2D1", desc: "Cerulean 代表著千禧年的天空色彩。" },
        ];

        // --- SVGs ---
        const ICONS = {
            refresh: `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>`,
            arrowRight: `<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`,
            arrowRightSmall: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`,
            close: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`,
            play: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>`,
            trophy: `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="#EAB308" stroke="#EAB308" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>`,
            share: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></svg>`,
            checkCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>`,
            xCross: `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="drop-shadow-md"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`
        };

        // --- State Management ---
        const state = {
            view: 'home', // home, intro, playing, gameover
            level: 1,
            currentBase: PANTONE_YEARS[0],
            introBase: null,
            oddColor: "",
            oddIndex: 0,
            wrongIndex: -1, // Tracks which card was clicked incorrectly
            showFeedback: false // Show correct feedback
        };

        // --- Helper Functions ---
        const hexToRgb = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        };

        const rgbToHex = (r, g, b) => {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
        };

        const generateVariantColor = (baseHex, level) => {
            const rgb = hexToRgb(baseHex);
            let difficulty = Math.max(1.5, 25 - (level * 1.2)); 
            
            const change = (val) => {
                const direction = Math.random() > 0.5 ? 1 : -1;
                let newVal = val + (difficulty * direction);
                if (newVal > 255) newVal = val - difficulty;
                if (newVal < 0) newVal = val + difficulty;
                if (Math.abs(newVal - val) < 2) {
                    newVal = val + (direction * 5); 
                }
                return Math.floor(Math.max(0, Math.min(255, newVal)));
            };

            const r = change(rgb.r);
            const g = change(rgb.g);
            const b = change(rgb.b);

            return rgbToHex(r, g, b);
        };

        const getRankTitle = (level) => {
            if (level < 5) return "色彩學徒 (Apprentice)";
            if (level < 10) return "設計助理 (Junior Designer)";
            if (level < 15) return "資深設計師 (Senior Designer)";
            if (level < 20) return "藝術總監 (Art Director)";
            if (level < 30) return "印刷廠師傅 (Print Master)";
            return "絕對色感神人 (Pantone God)";
        };

        const showToast = (message) => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = "bg-black text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 animate-fade-in-up";
            toast.innerHTML = `${ICONS.checkCircle}<span class="font-bold text-sm">${message}</span>`;
            
            container.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 2500);
        };

        // --- Core Logic ---
        const startRound = (specificBase = null) => {
            const base = specificBase || PANTONE_YEARS[Math.floor(Math.random() * PANTONE_YEARS.length)];
            state.currentBase = base;
            state.oddColor = generateVariantColor(base.hex, state.level);
            state.oddIndex = Math.floor(Math.random() * 4);
            state.wrongIndex = -1;
            state.showFeedback = false;
            render();
        };

        const startGame = (fromIntro = false) => {
            state.level = 1;
            state.view = 'playing';
            if (fromIntro && state.introBase) {
                startRound(state.introBase);
            } else {
                startRound();
            }
        };

        const handleCardClick = (index) => {
            if (state.showFeedback || state.wrongIndex !== -1) return; // Block clicks during feedback

            if (index === state.oddIndex) {
                // Correct
                state.level++;
                setTimeout(() => {
                    startRound();
                }, 200); // Tiny delay for feel
            } else {
                // Wrong
                if (navigator.vibrate) navigator.vibrate(200);
                state.wrongIndex = index; // Triggers shake and overlay
                state.showFeedback = true; // Shows correct answer indicator
                render(); // Re-render to show feedback
                
                setTimeout(() => {
                    state.view = 'gameover';
                    render();
                }, 1000);
            }
        };

        const handleShare = () => {
            const text = `我在 Pantone 色彩極限挑戰中活到了第 ${state.level} 關！稱號：${getRankTitle(state.level)}。你也來挑戰看看？`;
            navigator.clipboard.writeText(text).then(() => {
                showToast("成績已複製到剪貼簿！");
            }).catch(() => {
                showToast("複製失敗，請手動截圖分享");
            });
        };

        // --- Rendering ---
        const app = document.getElementById('app');
        const levelDisplay = document.getElementById('level-display');
        const levelIndicator = document.getElementById('level-indicator');

        const renderHome = () => {
            const currentYearColor = PANTONE_YEARS.find(p => p.year === 2025);
            const pastYearsColors = PANTONE_YEARS.filter(p => p.year !== 2025);

            let html = `
                <div class="animate-fade-in pb-12">
                    <div class="bg-black text-white p-6 shadow-xl mb-8 relative overflow-hidden group rounded-lg">
                        <h2 class="text-xl md:text-2xl font-black mb-4 uppercase tracking-wide border-b border-white/30 pb-2">How to Play</h2>
                        <ul class="space-y-4 font-bold text-sm md:text-base text-gray-200">
                            <li class="flex items-start gap-4">
                                <span class="bg-white text-black w-6 h-6 flex items-center justify-center rounded-full text-sm font-black shrink-0 mt-0.5 shadow-sm">1</span>
                                <span>畫面將顯示 4 張色卡。</span>
                            </li>
                            <li class="flex items-start gap-4">
                                <span class="bg-white text-black w-6 h-6 flex items-center justify-center rounded-full text-sm font-black shrink-0 mt-0.5 shadow-sm">2</span>
                                <span>找出唯一一張<span class="text-white font-black border-b-2 border-white ml-1">顏色不同</span>的色卡並點擊。</span>
                            </li>
                            <li class="flex items-start gap-4">
                                <span class="bg-white text-black w-6 h-6 flex items-center justify-center rounded-full text-sm font-black shrink-0 mt-0.5 shadow-sm">3</span>
                                <span>顏色差異會隨著關卡增加而越來越細微。</span>
                            </li>
                        </ul>
                    </div>

                    <button onclick="window.gameAction('random')" class="w-full bg-white border-2 border-black p-5 mb-10 font-black text-lg text-black hover:bg-black hover:text-white transition-all flex items-center justify-between group shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] rounded-lg active:scale-[0.98]">
                        <span class="flex items-center gap-3">${ICONS.refresh} 隨機挑戰 (RANDOM START)</span>
                        <span class="group-hover:translate-x-1 transition-transform">${ICONS.arrowRight}</span>
                    </button>

                    <div>
                        <h3 class="font-black text-xl mb-5 uppercase tracking-tighter flex items-center gap-3 text-black">
                            <span class="w-2 h-8 bg-black block rounded-sm"></span>
                            選擇 PANTONE 年度代表色
                        </h3>

                        ${currentYearColor ? `
                        <div onclick="window.gameAction('intro', ${currentYearColor.year})" class="w-full bg-white shadow-md hover:shadow-2xl transition-all cursor-pointer group border border-gray-200 flex flex-col md:flex-row h-auto md:h-52 mb-8 rounded-xl overflow-hidden transform hover:-translate-y-1">
                            <div class="h-48 md:h-full w-full md:w-5/12 relative" style="background-color: ${currentYearColor.hex}">
                                <div class="absolute top-4 left-4 bg-black/90 text-white text-[10px] px-3 py-1.5 rounded-full uppercase tracking-wider font-bold shadow-md ring-1 ring-white/20">2025 New Arrival</div>
                                <div class="absolute bottom-3 right-3 text-white/40 text-sm font-black tracking-widest uppercase">${currentYearColor.year}</div>
                            </div>
                            <div class="p-6 flex-1 flex flex-col justify-center bg-white relative">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/c/cc/Pantone_logo.svg" alt="PANTONE" class="h-6 md:h-8 object-contain object-left mb-4 opacity-80" />
                                <div class="text-sm font-mono font-bold text-gray-400 mb-1">${currentYearColor.code}</div>
                                <div class="text-3xl font-black text-gray-900 leading-none mb-2">${currentYearColor.name}</div>
                                <div class="text-xl font-bold text-gray-600">${currentYearColor.nameCN}</div>
                                <div class="mt-4 flex items-center text-xs font-bold text-gray-400 gap-2 group-hover:text-black transition-colors">
                                    <span>了解更多</span>
                                    <span class="group-hover:translate-x-1 transition-transform">${ICONS.arrowRightSmall}</span>
                                </div>
                            </div>
                        </div>` : ''}

                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-8">
                            ${pastYearsColors.map(p => `
                                <div onclick="window.gameAction('intro', ${p.year}, '${p.name}')" class="bg-white aspect-[3/4] shadow-sm hover:shadow-xl transition-all cursor-pointer group border border-gray-100 flex flex-col rounded-lg overflow-hidden transform hover:-translate-y-1">
                                    <div class="h-[65%] w-full relative" style="background-color: ${p.hex}">
                                        <div class="absolute bottom-2 right-2 text-white/60 text-[10px] font-black tracking-widest uppercase bg-black/10 px-1 rounded">${p.year}</div>
                                    </div>
                                    <div class="p-3 flex-1 flex flex-col justify-end bg-white border-t border-gray-50">
                                        <div class="text-[10px] font-mono font-bold text-gray-400 mb-0.5">${p.code}</div>
                                        <div class="text-sm font-black text-gray-900 leading-tight truncate">${p.name}</div>
                                        <div class="text-xs font-bold text-gray-500 mt-0.5 truncate">${p.nameCN}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            return html;
        };

        const renderIntro = () => {
            const p = state.introBase;
            if (!p) return '';
            return `
                <div class="animate-fade-in flex flex-col bg-white rounded-xl shadow-2xl overflow-hidden mb-12 border border-gray-200 relative">
                    <button onclick="window.gameAction('home')" class="absolute top-4 right-4 p-2 z-20 bg-white/90 hover:bg-white text-black rounded-full shadow-lg transition-transform hover:scale-110">
                        ${ICONS.close}
                    </button>
                    <div class="flex flex-col border-b-[16px]" style="border-color: ${p.hex}">
                        <div class="w-full h-64 md:h-80 relative" style="background-color: ${p.hex}">
                            <div class="absolute bottom-6 left-6 md:left-8 bg-black/80 backdrop-blur-md px-4 py-2 text-xs font-bold tracking-widest uppercase text-white rounded-lg shadow-lg">
                                Pantone Color of the Year ${p.year}
                            </div>
                        </div>
                        <div class="p-6 md:p-10 flex flex-col relative overflow-hidden bg-white">
                            <h2 class="text-[6rem] md:text-[9rem] font-black text-gray-100 absolute select-none -top-10 right-0 z-0 leading-none opacity-60">${p.year}</h2>
                            <div class="relative z-10 mb-8">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/c/cc/Pantone_logo.svg" alt="PANTONE" class="h-6 md:h-8 object-contain object-left mb-4" />
                                <h2 class="text-4xl md:text-5xl font-black text-black mb-2 leading-tight tracking-tight">${p.name}</h2>
                                <h3 class="text-2xl md:text-3xl font-bold text-gray-600 mb-3 leading-none">${p.nameCN}</h3>
                                <p class="font-mono font-bold text-gray-400 text-lg">PANTONE ${p.code}</p>
                            </div>
                            <div class="relative z-10">
                                <h3 class="font-bold text-xs uppercase tracking-widest text-black mb-4 border-b-2 border-black inline-block pb-1">About the Color</h3>
                                <p class="text-gray-700 leading-relaxed font-medium text-justify text-sm md:text-base lg:text-lg">${p.desc}</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-gray-50 border-t border-gray-100">
                        <button onclick="window.gameAction('startIntro')" class="w-full bg-black text-white py-5 font-black text-xl hover:bg-neutral-800 transition-all flex items-center justify-center gap-3 shadow-xl rounded-lg active:scale-[0.99]">
                            ${ICONS.play} START CHALLENGE
                        </button>
                    </div>
                </div>
            `;
        };

        const renderPlaying = () => {
            let cardsHtml = '';
            for (let i = 0; i < 4; i++) {
                const isOdd = i === state.oddIndex;
                const isWrong = i === state.wrongIndex;
                const color = isOdd ? state.oddColor : state.currentBase.hex;
                
                let feedbackHtml = '';
                if (state.showFeedback && isOdd) {
                    feedbackHtml = `
                        <div class="absolute inset-0 flex items-center justify-center z-10">
                            <div class="bg-white/40 rounded-full p-4 shadow-lg backdrop-blur-sm">
                                <div class="w-8 h-8 bg-white rounded-full animate-ping"></div>
                            </div>
                        </div>`;
                }
                if (isWrong) {
                    feedbackHtml = `
                        <div class="absolute inset-0 bg-red-500/50 flex items-center justify-center z-10 animate-pulse-fast">
                            ${ICONS.xCross}
                        </div>`;
                }

                const shakeClass = isWrong ? 'animate-shake' : '';

                cardsHtml += `
                    <div onclick="window.gameAction('clickCard', ${i})" class="relative bg-white shadow-lg flex flex-col transition-all duration-200 cursor-pointer hover:shadow-2xl hover:scale-[1.02] rounded-lg overflow-hidden ${shakeClass}" style="min-height: 280px">
                        <div class="flex-1 w-full relative group min-h-[160px]" style="background-color: ${color}">
                            ${feedbackHtml}
                        </div>
                        <div class="w-full p-3 md:p-4 flex flex-col justify-end text-left select-none border-t border-gray-100 bg-white shrink-0">
                            <div class="mb-2">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/c/cc/Pantone_logo.svg" alt="PANTONE" class="h-5 md:h-6 object-contain object-left" />
                            </div>
                            <p class="text-slate-500 font-mono text-xs md:text-sm font-bold tracking-wide leading-none mb-1">${state.currentBase.code}</p>
                            <div class="flex flex-col min-w-0">
                                <p class="text-slate-900 font-black text-base md:text-lg leading-tight truncate">${state.currentBase.name}</p>
                                <p class="text-slate-500 font-bold text-xs md:text-sm leading-tight mt-0.5 truncate">${state.currentBase.nameCN}</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="grid grid-cols-2 gap-4 md:gap-6 animate-fade-in w-full max-w-md mx-auto pb-12">
                    ${cardsHtml}
                </div>
            `;
        };

        const renderGameOver = () => {
            return `
                <div class="bg-white p-8 shadow-[0_25px_50px_-12px_rgba(0,0,0,0.25)] text-center animate-fade-in border-t-[16px] relative rounded-xl overflow-hidden max-w-md mx-auto mb-12" style="border-color: ${state.currentBase.hex}">
                    <div class="absolute -top-14 left-1/2 -translate-x-1/2 bg-white rounded-full p-4 shadow-xl border-4 border-gray-50">
                        ${ICONS.trophy}
                    </div>
                    <h2 class="text-3xl font-black mb-2 mt-8 uppercase tracking-tight text-black">Game Over</h2>
                    <p class="text-gray-500 font-bold mb-8">Stopped at Level ${state.level}</p>
                    <div class="bg-neutral-50 p-6 border-l-4 border-black text-left mb-8 rounded-r-lg shadow-inner">
                        <div class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">Your Rank</div>
                        <div class="text-2xl font-black text-black leading-tight">${getRankTitle(state.level)}</div>
                        <div class="w-full h-px bg-gray-200 my-4"></div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-gray-400 uppercase">Total Score</span>
                            <span class="text-3xl font-black text-black">${state.level - 1}</span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <button onclick="window.gameAction('home')" class="w-full bg-gray-100 text-black py-4 font-black hover:bg-gray-200 transition flex items-center justify-center gap-2 uppercase tracking-wide text-sm rounded-lg">
                            ${ICONS.refresh} Try Again
                        </button>
                        <button onclick="window.gameAction('share')" class="w-full bg-black text-white py-4 font-black hover:bg-neutral-800 transition flex items-center justify-center gap-2 uppercase tracking-wide text-sm rounded-lg">
                            ${ICONS.share} Share Result
                        </button>
                    </div>
                    <div class="mt-8 text-[11px] font-bold text-gray-400 font-mono bg-gray-50 py-2 rounded">
                        FAILED ON: <span class="text-gray-800">${state.currentBase.name.toUpperCase()}</span> (${state.currentBase.nameCN})
                    </div>
                </div>
            `;
        };

        const render = () => {
            // Update Header
            if (state.view === 'playing') {
                levelIndicator.classList.remove('hidden');
                levelDisplay.textContent = state.level;
            } else {
                levelIndicator.classList.add('hidden');
            }

            // Render Content
            if (state.view === 'home') {
                app.innerHTML = renderHome();
            } else if (state.view === 'intro') {
                app.innerHTML = renderIntro();
            } else if (state.view === 'playing') {
                app.innerHTML = renderPlaying();
            } else if (state.view === 'gameover') {
                app.innerHTML = renderGameOver();
            }
        };

        // --- Global Event Handler ---
        window.gameAction = (action, payload1, payload2) => {
            if (action === 'random') {
                startRandomGame();
            } else if (action === 'intro') {
                // Find year object, payload1 is year, payload2 is name (optional check)
                // Actually easier to just find by year or handle unique keys in loop
                const year = payload1;
                // Since duplicate years exist (2021, 2016), we might need more precise selection if just year passed
                // The loop above passes year and name if needed, but year + name combo is unique
                // Let's just find the exact object in PANTONE_YEARS based on strict match if possible or just loop index
                // Simplified: Pass the year, if duplicates, we might grab first. 
                // Better approach: Pass index in array. But let's stick to year logic for now or filter.
                // Re-find based on click context? 
                // Let's iterate and match.
                // Actually, let's just pass the index in array? Safer.
                // Updated logic: find matching year and name if provided, or just year.
                
                let target;
                if (payload2) {
                    target = PANTONE_YEARS.find(p => p.year === payload1 && p.name === payload2);
                } else {
                    target = PANTONE_YEARS.find(p => p.year === payload1);
                }
                
                if (target) {
                    handleYearSelect(target);
                }
                render(); // Ensure scroll reset happens in handleYearSelect
            } else if (action === 'home') {
                state.view = 'home';
                render();
            } else if (action === 'startIntro') {
                startGameFromIntro();
            } else if (action === 'clickCard') {
                handleCardClick(payload1);
            } else if (action === 'share') {
                handleShare();
            }
        };

        // Initialize
        render();

    </script>
</body>
</html>
